(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{14717:(e,t,s)=>{"use strict";s.d(t,{E:()=>r});var a=s(66384),n=s(35515);function r(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"skeleton",className:(0,n.cn)("bg-accent animate-pulse rounded-md",t),...s})}},25815:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eW});var a=s(66384),n=s(16636),r=s(44139),i=s(35515);function c(e){let{className:t,...s}=e;return(0,a.jsx)(r.bL,{"data-slot":"tabs",className:(0,i.cn)("flex flex-col gap-2",t),...s})}function l(e){let{className:t,...s}=e;return(0,a.jsx)(r.B8,{"data-slot":"tabs-list",className:(0,i.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...s})}function o(e){let{className:t,...s}=e;return(0,a.jsx)(r.l9,{"data-slot":"tabs-trigger",className:(0,i.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function d(e){let{className:t,...s}=e;return(0,a.jsx)(r.UC,{"data-slot":"tabs-content",className:(0,i.cn)("flex-1 outline-none",t),...s})}var u=s(35639),m=s(92944),x=s(19934),h=s(1669),p=s(55212),j=s(56434),g=s(67435),f=s(43441),N=s(85754),v=s(22074),b=s(31238),y=s(21275),w=s(42622),D=s(90232),C=s(46978),I=s(35737),k=s(46276),P=s(62855),A=s(52142),S=s(10615);let E=S.bL,T=S.l9,R=n.forwardRef((e,t)=>{let{className:s,align:n="center",sideOffset:r=4,...c}=e;return(0,a.jsx)(S.ZL,{children:(0,a.jsx)(S.UC,{ref:t,align:n,sideOffset:r,className:(0,i.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...c})})});R.displayName=S.UC.displayName;var F=s(80055),M=s(51539),O=s(10483),_=s(78342),L=s(62166);let q=F.Op,V=n.createContext({}),z=e=>{let{...t}=e;return(0,a.jsx)(V.Provider,{value:{name:t.name},children:(0,a.jsx)(F.xI,{...t})})},U=()=>{let e=n.useContext(V),t=n.useContext(J),{getFieldState:s,formState:a}=(0,F.xW)(),r=s(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...r}},J=n.createContext({}),$=n.forwardRef((e,t)=>{let{className:s,...r}=e,c=n.useId();return(0,a.jsx)(J.Provider,{value:{id:c},children:(0,a.jsx)("div",{ref:t,className:(0,i.cn)("space-y-2",s),...r})})});$.displayName="FormItem";let B=n.forwardRef((e,t)=>{let{className:s,...n}=e,{error:r,formItemId:c}=U();return(0,a.jsx)(A.J,{ref:t,className:(0,i.cn)(r&&"text-destructive",s),htmlFor:c,...n})});B.displayName="FormLabel";let G=n.forwardRef((e,t)=>{let{...s}=e,{error:n,formItemId:r,formDescriptionId:i,formMessageId:c}=U();return(0,a.jsx)(L.DX,{ref:t,id:r,"aria-describedby":n?"".concat(i," ").concat(c):"".concat(i),"aria-invalid":!!n,...s})});G.displayName="FormControl",n.forwardRef((e,t)=>{let{className:s,...n}=e,{formDescriptionId:r}=U();return(0,a.jsx)("p",{ref:t,id:r,className:(0,i.cn)("text-sm text-muted-foreground",s),...n})}).displayName="FormDescription";let Q=n.forwardRef((e,t)=>{let{className:s,children:n,...r}=e,{error:c,formMessageId:l}=U(),o=c?String(null==c?void 0:c.message):n;return o?(0,a.jsx)("p",{ref:t,id:l,className:(0,i.cn)("text-sm font-medium text-destructive",s),...r,children:o}):null});Q.displayName="FormMessage";var Y=s(28016),Z=s(51797),K=s(98377),H=s(64533),W=s(28330);async function X(){try{let e=await (0,W.v$)("".concat(W.Sn.inventory.base,"/stocks"));if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.message||"Failed to fetch stock entries")}return e.json()}catch(e){throw e instanceof W.Ny&&window.location.replace("/auth/login"),e}}async function ee(e){try{let t=await (0,W.v$)("".concat(W.Sn.inventory.base,"/stocks"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||"Failed to create stock entry")}return t.json()}catch(e){throw e instanceof W.Ny&&window.location.replace("/auth/login"),e}}async function et(e,t){try{let s=await (0,W.v$)("".concat(W.Sn.inventory.base,"/stocks/").concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.message||"Failed to update stock entry")}return s.json()}catch(e){throw e instanceof W.Ny&&window.location.replace("/auth/login"),e}}async function es(e){try{let t=await (0,W.v$)("".concat(W.Sn.inventory.base,"/stocks/").concat(e),{method:"DELETE"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||"Failed to delete stock entry")}}catch(e){throw e instanceof W.Ny&&window.location.replace("/auth/login"),e}}var ea=s(94204);let en=O.Ik({quantity:O.ai().min(1),unitPrice:O.ai().min(0),costPrice:O.ai().min(0),expirationDate:O.Yj().refine(e=>new Date(e)>new Date,{message:"Expiration date must be in the future"}),batchNumber:O.Yj().optional(),supplierInfo:O.Ik({supplierId:O.Yj().optional(),supplierName:O.Yj().optional()}).optional().nullable()});function er(e){return e&&"object"==typeof e&&"id"in e&&"name"in e&&"productType"in e}function ei(e){return e&&"object"==typeof e&&"id"in e&&"name"in e&&"productType"in e}let ec={CATALOG_PRODUCT_FAMILY:"Product Family",CATALOG_PRODUCT_VARIANT:"Product Variant",MEDICINE_GENERIC:"Generic Medicine",MEDICINE_BRAND:"Brand Medicine",MEDICINE_VARIANT:"Medicine Variant"},el=e=>ec[e]||e,eo=e=>e<10,ed=e=>{if(!e)return!1;let t=new Date(e),s=new Date;return t<=new Date(s.getFullYear(),s.getMonth()+1,s.getDate())},eu=e=>{let t=new Date(e),s=new Date;return Math.ceil((t.getTime()-s.getTime())/864e5)},em=e=>{if(!e)return{isExpiring:!1,message:""};let t=eu(e);return t<0?{isExpiring:!0,message:"Expired"}:0===t?{isExpiring:!0,message:"Expiring today"}:t<=30?{isExpiring:!0,message:"Expires in ".concat(t," days")}:{isExpiring:!1,message:""}},ex=e=>{switch(e){case"GENERIC":case"PRODUCT_FAMILY":default:return(0,a.jsx)(j.A,{className:"h-4 w-4"});case"VARIANT":case"PRODUCT_VARIANT":return(0,a.jsx)(g.A,{className:"h-4 w-4"});case"BRAND":return(0,a.jsx)(f.A,{className:"h-4 w-4"})}},eh=e=>{switch(e){case"GENERIC":case"PRODUCT_FAMILY":return"bg-green-100 text-green-800";case"VARIANT":case"PRODUCT_VARIANT":return"bg-purple-100 text-purple-800";case"BRAND":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},ep=e=>{let t=e.domain.toUpperCase(),s=e.type.toUpperCase();if("MEDICINE"===t){if("GENERIC"===s)return"MEDICINE_GENERIC";if("BRAND"===s)return"MEDICINE_BRAND";if("VARIANT"===s)return"MEDICINE_VARIANT"}if("CATALOG"===t){if("PRODUCT_FAMILY"===s)return"CATALOG_PRODUCT_FAMILY";if("PRODUCT_VARIANT"===s)return"CATALOG_PRODUCT_VARIANT"}throw Error("Invalid item domain/type combination: ".concat(e.domain,"/").concat(e.type))};function ej(e,t){var s;return(null==e?void 0:e.variantDetails)&&e.variantDetails[t]?e.variantDetails[t]:(null==e||null==(s=e.brandDetails)?void 0:s.variant)&&e.brandDetails.variant[t]?e.brandDetails.variant[t]:""}function eg(e){let{coverages:t,label:s}=e;return t&&0!==t.length?(0,a.jsxs)("div",{className:"space-y-2 border rounded p-4 bg-muted/30",children:[(0,a.jsx)("h4",{className:"text-md font-semibold mb-2",children:s}),(0,a.jsx)("div",{className:"space-y-2",children:t.map((e,t)=>(0,a.jsxs)("div",{className:"border rounded p-2 bg-white/80",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("span",{className:"font-medium",children:e.insuranceName}),e.status&&(0,a.jsx)(h.E,{variant:"ACTIVE"===e.status?"default":"secondary",children:e.status})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[void 0!==e.insurancePrice&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Insurance Price:"})," ",e.insurancePrice," Rwf"]}),void 0!==e.clientContributionPercentage&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Client Contribution:"})," ",e.clientContributionPercentage,"%"]}),e.requiresPreApproval&&(0,a.jsx)("div",{className:"col-span-2 text-xs text-muted-foreground",children:"Pre-approval required"})]}),e.notes&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:e.notes})]},e.id||t))})]}):null}function ef(e){return e&&"object"==typeof e&&"sku"in e&&"brand"in e&&"unitOfMeasure"in e}function eN(e){return e?"string"==typeof e?e:"object"==typeof e&&"value"in e&&"unit"in e?"".concat(e.value," ").concat(e.unit):"":""}function ev(){let[e,t]=(0,n.useState)(""),[s,r]=(0,n.useState)([]),[i,c]=(0,n.useState)(""),[l,o]=(0,n.useState)(null),[d,j]=(0,n.useState)(!1),[g,f]=(0,n.useState)(null),[S,O]=(0,n.useState)(!1),L=(0,u.jE)(),[V,U]=(0,n.useState)("list"),[J,W]=(0,n.useState)("none"),[eu,ev]=(0,n.useState)([]),ey=(0,F.mN)({resolver:(0,M.u)(en),defaultValues:{quantity:1,unitPrice:0,costPrice:0,expirationDate:"",batchNumber:"",supplierInfo:null}}),{data:ew,isLoading:eD}=(0,ea.i)(i),{stockEntries:eC,isLoading:eI,createStockEntry:ek,isCreating:eP,createError:eA,updateStockEntry:eS,isUpdating:eE,updateError:eT,deleteStockEntry:eR,isDeleting:eF,deleteError:eM}=function(){let e=(0,u.jE)(),{data:t,isLoading:s,error:a}=(0,K.I)({queryKey:["stockEntries"],queryFn:X}),{mutateAsync:n,isPending:r,error:i}=(0,H.n)({mutationFn:ee,onSuccess:()=>{e.invalidateQueries({queryKey:["stockEntries"]})}}),{mutateAsync:c,isPending:l,error:o}=(0,H.n)({mutationFn:e=>{let{id:t,data:s}=e;return et(t,s)},onSuccess:()=>{e.invalidateQueries({queryKey:["stockEntries"]})}}),{mutateAsync:d,isPending:m,error:x}=(0,H.n)({mutationFn:es,onSuccess:()=>{e.invalidateQueries({queryKey:["stockEntries"]})}});return{stockEntries:(null==t?void 0:t.content)||[],isLoading:s,error:a,createStockEntry:n,isCreating:r,createError:i,updateStockEntry:c,isUpdating:l,updateError:o,deleteStockEntry:d,isDeleting:m,deleteError:x}}(),eO=e=>{if("MEDICINE"===e.productReference.sourceService){let t=e.productData.medicineData;if(t&&er(t)){let e=L.getQueryData(["medicine",t.id]);return e&&er(e)?e.name:t.name}}else if("CATALOG"===e.productReference.sourceService){let t=e.productData.catalogProductData;if(ei(t)){let e=L.getQueryData(["catalog",t.id]);return e&&ei(e)?e.name:t.name}}return"Unknown Product"},e_=e=>e.reduce((e,t)=>{let s=t.productReference.referenceId,a=e.find(e=>e.productId===s);return a?(a.totalQuantity+=t.stockDetails.quantity,a.totalValue+=t.stockDetails.quantity*t.stockDetails.unitPrice,a.stocks.push(t)):e.push({productId:s,productName:eO(t),productType:t.productReference.productType,totalQuantity:t.stockDetails.quantity,totalValue:t.stockDetails.quantity*t.stockDetails.unitPrice,stocks:[t],isExpanded:!1}),e},[]),eL=e=>{ev(t=>t.map(t=>t.productId===e?{...t,isExpanded:!t.isExpanded}:t))};(0,n.useEffect)(()=>{eC&&ev(e_(eC))},[eC]);let eq=e=>{switch(J){case"expiration_asc":return[...e].sort((e,t)=>(e.stockDetails.expirationDate?new Date(e.stockDetails.expirationDate).getTime():1/0)-(t.stockDetails.expirationDate?new Date(t.stockDetails.expirationDate).getTime():1/0));case"expiration_desc":return[...e].sort((e,t)=>{let s=e.stockDetails.expirationDate?new Date(e.stockDetails.expirationDate).getTime():1/0;return(t.stockDetails.expirationDate?new Date(t.stockDetails.expirationDate).getTime():1/0)-s});default:return e}},[eV,ez]=(0,n.useState)(null),[eU,eJ]=(0,n.useState)(!1),[e$,eB]=(0,n.useState)(!1),eG=async e=>{if(l)try{var t,s;let a={productReference:{referenceId:l.id,productType:ep(l),sourceService:l.domain.toUpperCase()},quantity:e.quantity,unitPrice:e.unitPrice,costPrice:e.costPrice,expirationDate:(e=>{let t=new Date(e),s=new Date;return t.setHours(s.getHours()),t.setMinutes(s.getMinutes()),t.setSeconds(s.getSeconds()),t.toISOString().split(".")[0]})(e.expirationDate),batchNumber:e.batchNumber||"",supplierInfo:(null==(t=e.supplierInfo)?void 0:t.supplierId)&&(null==(s=e.supplierInfo)?void 0:s.supplierName)?{supplierId:e.supplierInfo.supplierId,supplierName:e.supplierInfo.supplierName}:null};await ek(a),_.o.success("Stock entry created successfully"),j(!1),ey.reset()}catch(e){_.o.error(e.message||"Failed to create stock entry"),console.error(e)}};return(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(x.ZB,{children:"Stock Management"}),(0,a.jsx)(x.BT,{children:"View and manage your current stock"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["list"===V?(0,a.jsxs)(p.$,{variant:"outline",size:"sm",onClick:()=>{switch(J){case"none":W("expiration_asc");break;case"expiration_asc":W("expiration_desc");break;default:W("none")}},className:"flex items-center gap-2",children:[(0,a.jsx)(N.A,{className:"h-4 w-4"}),"none"===J?"Sort by Expiration":"expiration_asc"===J?"Expiration ↑":"Expiration ↓"]}):(0,a.jsxs)(p.$,{variant:"outline",size:"sm",onClick:()=>{switch(J){case"none":W("quantity_asc");break;case"quantity_asc":W("quantity_desc");break;default:W("none")}},className:"flex items-center gap-2",children:[(0,a.jsx)(N.A,{className:"h-4 w-4"}),"none"===J?"Sort by Quantity":"quantity_asc"===J?"Quantity ↑":"Quantity ↓"]}),(0,a.jsx)(p.$,{variant:"outline",size:"sm",onClick:()=>{U("list"===V?"tree":"list"),W("none")},children:"list"===V?"Group View":"List View"}),(0,a.jsxs)(k.lG,{open:d,onOpenChange:j,children:[(0,a.jsx)(k.zM,{asChild:!0,children:(0,a.jsxs)(p.$,{onClick:()=>{j(!0),o(null),c("")},children:[(0,a.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Add New Stock"]})}),(0,a.jsxs)(k.Cf,{className:"sm:max-w-[600px]",children:[(0,a.jsxs)(k.c7,{children:[(0,a.jsx)(k.L3,{children:"Add Stock Entry"}),(0,a.jsx)(k.rr,{children:l?"Add stock for ".concat(l.data.name):"Search for a product or medicine to add stock"})]}),(0,a.jsx)("div",{className:"space-y-4",children:l?(0,a.jsx)(q,{...ey,children:(0,a.jsxs)("form",{onSubmit:ey.handleSubmit(eG),className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[ex(l.type),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:l.data.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[l.domain," - ",l.type]})]})]}),(0,a.jsx)(p.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>o(null),children:"Change"})]}),(0,a.jsx)(z,{control:ey.control,name:"quantity",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Quantity"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{type:"number",min:1,...t,onChange:e=>t.onChange(Number(e.target.value))})}),(0,a.jsx)(Q,{})]})}}),(0,a.jsx)(z,{control:ey.control,name:"unitPrice",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Unit Price"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{type:"number",min:0,step:.01,...t,onChange:e=>t.onChange(Number(e.target.value))})}),(0,a.jsx)(Q,{})]})}}),(0,a.jsx)(z,{control:ey.control,name:"costPrice",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Cost Price"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{type:"number",min:0,step:.01,...t,onChange:e=>t.onChange(Number(e.target.value))})}),(0,a.jsx)(Q,{})]})}}),(0,a.jsx)(z,{control:ey.control,name:"expirationDate",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Expiration Date"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{type:"date",min:new Date().toISOString().split("T")[0],...t})}),(0,a.jsx)(Q,{})]})}}),(0,a.jsx)(z,{control:ey.control,name:"batchNumber",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Batch Number"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{...t,value:t.value||""})}),(0,a.jsx)(Q,{})]})}}),e$?(0,a.jsxs)("div",{className:"space-y-4 border rounded-md p-3 bg-muted/30",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h4",{className:"font-medium",children:"Supplier Information (Optional)"}),(0,a.jsx)(p.$,{type:"button",size:"sm",variant:"ghost",onClick:()=>{eB(!1),ey.setValue("supplierInfo.supplierId",""),ey.setValue("supplierInfo.supplierName","")},children:"Remove"})]}),(0,a.jsx)(z,{control:ey.control,name:"supplierInfo.supplierId",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Supplier ID"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{...t,value:t.value||""})}),(0,a.jsx)(Q,{})]})}}),(0,a.jsx)(z,{control:ey.control,name:"supplierInfo.supplierName",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Supplier Name"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{...t,value:t.value||""})}),(0,a.jsx)(Q,{})]})}})]}):(0,a.jsx)(p.$,{type:"button",variant:"outline",className:"w-full",onClick:()=>eB(!0),children:"+ Add Supplier Information"}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(p.$,{type:"button",variant:"outline",onClick:()=>j(!1),disabled:eP,children:"Cancel"}),(0,a.jsx)(p.$,{type:"submit",disabled:eP,children:eP?"Creating...":"Create Stock Entry"})]})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(b.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(m.p,{placeholder:"Search products, medicines, brands, generics, SKUs...",value:i,onChange:e=>c(e.target.value),className:"pl-10"})]}),(0,a.jsx)("div",{className:"max-h-[300px] overflow-y-auto space-y-2",children:eD?(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Searching..."})]}):(null==ew?void 0:ew.results.length)===0?(0,a.jsx)("div",{className:"text-center py-4",children:(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:['No results found for "',i,'"']})}):null==ew?void 0:ew.results.map(e=>{var t,s;let n="medicine"===e.domain,r=n?e.data:null,i="catalog"===e.domain,c=i?e.data:null,l=n&&r&&r.insuranceCoverages?r.insuranceCoverages:[],d=r&&r.price||c&&c.price;return(0,a.jsx)(x.Zp,{className:"cursor-pointer hover:shadow-md transition-shadow relative",onClick:()=>o(e),children:(0,a.jsxs)(x.aR,{className:"pb-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[ex(e.type),(0,a.jsx)(x.ZB,{className:"text-lg",children:e.data.name})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(h.E,{className:eh(e.type),children:[e.domain," - ",e.type]}),(0,a.jsx)(p.$,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7",tabIndex:-1,onClick:t=>{t.stopPropagation(),ez(e),eJ(!0)},children:(0,a.jsx)(y.A,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"mt-1 space-y-1 text-xs text-muted-foreground",children:[n&&r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:["BRAND"===e.type&&(t=r)&&"object"==typeof t&&"brandDetails"in t&&"object"==typeof t.brandDetails&&null!==t.brandDetails&&r.brandDetails.variant&&(0,a.jsxs)(a.Fragment,{children:[r.brandDetails.variant.form&&(0,a.jsxs)("span",{children:["Form: ",(0,a.jsx)("b",{children:r.brandDetails.variant.form})]}),r.brandDetails.variant.route&&(0,a.jsxs)("span",{children:["Route: ",(0,a.jsx)("b",{children:r.brandDetails.variant.route})]}),Array.isArray(r.brandDetails.variant.generics)&&r.brandDetails.variant.generics.length>0&&r.brandDetails.variant.generics.some(e=>e.isParent&&e.variantDetails)&&(()=>{let e=r.brandDetails.variant.generics.find(e=>e.isParent&&e.variantDetails);if(!e)return null;let t=e.variantDetails;return(0,a.jsxs)(a.Fragment,{children:[t.form&&(0,a.jsxs)("span",{children:["Parent Form: ",(0,a.jsx)("b",{children:t.form})]}),t.route&&(0,a.jsxs)("span",{children:["Parent Route: ",(0,a.jsx)("b",{children:t.route})]})]})})()]}),"VARIANT"===e.type&&(s=r)&&"object"==typeof s&&"variantDetails"in s&&"object"==typeof s.variantDetails&&null!==s.variantDetails&&(0,a.jsxs)(a.Fragment,{children:[r.variantDetails.form&&(0,a.jsxs)("span",{children:["Form: ",(0,a.jsx)("b",{children:r.variantDetails.form})]}),r.variantDetails.route&&(0,a.jsxs)("span",{children:["Route: ",(0,a.jsx)("b",{children:r.variantDetails.route})]})]}),"BRAND"!==e.type&&"VARIANT"!==e.type&&r.form&&(0,a.jsxs)("span",{children:["Form: ",(0,a.jsx)("b",{children:r.form})]}),"BRAND"!==e.type&&"VARIANT"!==e.type&&r.route&&(0,a.jsxs)("span",{children:["Route: ",(0,a.jsx)("b",{children:r.route})]}),r.manufacturer&&(0,a.jsxs)("span",{children:["Manufacturer: ",(0,a.jsx)("b",{children:r.manufacturer})]}),d&&(0,a.jsxs)("span",{children:["Price: ",(0,a.jsxs)("b",{children:[d," Rwf"]})]})]}),l.length>0&&(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 items-center",children:[(0,a.jsx)("span",{children:"Insurances:"}),l.map(e=>(0,a.jsxs)(h.E,{variant:"outline",className:"px-1 py-0.5 text-[10px] border-green-300 bg-green-50 text-green-800",children:[e.insuranceName,void 0!==e.insurancePrice&&(0,a.jsxs)(a.Fragment,{children:[" - ",e.insurancePrice," Rwf"]}),void 0!==e.clientContributionPercentage&&(0,a.jsxs)(a.Fragment,{children:[" | Client: ",e.clientContributionPercentage,"%"]})]},e.id))]})]}),i&&c&&(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:["sku"in c&&c.sku&&(0,a.jsxs)("span",{children:["SKU: ",(0,a.jsx)("b",{children:c.sku})]}),"brand"in c&&c.brand&&(0,a.jsxs)("span",{children:["Brand: ",(0,a.jsx)("b",{children:c.brand})]}),"manufacturer"in c&&c.manufacturer&&(0,a.jsxs)("span",{children:["Manufacturer: ",(0,a.jsx)("b",{children:c.manufacturer})]}),d&&(0,a.jsxs)("span",{children:["Price: ",(0,a.jsxs)("b",{children:[d," Rwf"]})]}),"PRODUCT_VARIANT"===e.type&&ef(c)&&(0,a.jsxs)(a.Fragment,{children:[c.weight&&(0,a.jsxs)("span",{children:["Weight: ",(0,a.jsx)("b",{children:eN(c.weight)})]}),c.unitOfMeasure&&(0,a.jsxs)("span",{children:["Unit: ",(0,a.jsx)("b",{children:c.unitOfMeasure})]}),c.color&&(0,a.jsxs)("span",{children:["Color: ",(0,a.jsx)("b",{children:c.color})]}),c.specifications&&Object.keys(c.specifications).length>0&&(0,a.jsxs)("span",{children:["Specs: ",(0,a.jsx)("b",{children:Object.entries(c.specifications).map(e=>{let[t,s]=e;return"".concat(t,": ").concat(s)}).join(", ")})]})]})]})]}),e.data.description&&(0,a.jsx)(x.BT,{children:e.data.description})]})},e.id)})})]})})]})]})]})]})}),(0,a.jsx)(x.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(b.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(m.p,{placeholder:"Search stock entries...",value:e,onChange:e=>t(e.target.value),className:"pl-10"})]}),(0,a.jsxs)(E,{children:[(0,a.jsx)(T,{asChild:!0,children:(0,a.jsxs)(p.$,{variant:"outline",className:"w-[200px] justify-start",children:[(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4"}),s.length>0?(0,a.jsxs)("span",{className:"flex-1 text-left",children:[s.length," type",1!==s.length?"s":""," selected"]}):(0,a.jsx)("span",{className:"flex-1 text-left",children:"All Types"})]})}),(0,a.jsx)(R,{className:"w-[200px] p-4",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-medium",children:"Filter by Type"}),(0,a.jsx)("div",{className:"space-y-2",children:Object.entries(ec).map(e=>{let[t,n]=e;return(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(P.S,{id:t,checked:s.includes(t),onCheckedChange:e=>{e?r([...s,t]):r(s.filter(e=>e!==t))}}),(0,a.jsx)(A.J,{htmlFor:t,children:n})]},t)})})]})})]})]}),eI?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,a.jsx)("p",{className:"mt-2 text-muted-foreground",children:"Loading stock entries..."})]}):"tree"===V?(0,a.jsx)("div",{className:"space-y-2",children:(e=>{switch(J){case"quantity_asc":return[...e].sort((e,t)=>e.totalQuantity-t.totalQuantity);case"quantity_desc":return[...e].sort((e,t)=>t.totalQuantity-e.totalQuantity);default:return e}})(eu).map(e=>{let t=eo(e.totalQuantity),s=e.stocks.some(e=>ed(e.stockDetails.expirationDate));return(0,a.jsxs)("div",{className:"border rounded-lg",children:[(0,a.jsxs)("div",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-muted/50",onClick:()=>eL(e.productId),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.isExpanded?(0,a.jsx)(D.A,{className:"h-4 w-4"}):(0,a.jsx)(C.A,{className:"h-4 w-4"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[ex(e.productType),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("h4",{className:"font-medium",children:e.productName}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Total Quantity: ",e.totalQuantity," | Total Value: ",e.totalValue.toFixed(2)," Rwf"]}),(0,a.jsxs)("div",{className:"absolute -top-1 -right-1 flex gap-1",children:[t&&(0,a.jsx)(Z.Bc,{children:(0,a.jsxs)(Z.m_,{children:[(0,a.jsx)(Z.k$,{children:(0,a.jsx)("div",{className:"w-2 h-2 bg-orange-500 rounded-full"})}),(0,a.jsx)(Z.ZI,{children:(0,a.jsxs)("p",{children:["Low stock: ",e.totalQuantity," units"]})})]})}),s&&(0,a.jsx)(Z.Bc,{children:(0,a.jsxs)(Z.m_,{children:[(0,a.jsx)(Z.k$,{children:(0,a.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full"})}),(0,a.jsx)(Z.ZI,{children:(0,a.jsx)("p",{children:"Expiring soon"})})]})})]})]})]})]}),(0,a.jsx)(h.E,{className:eh(e.productType),children:el(e.productType)})]}),e.isExpanded&&(0,a.jsx)("div",{className:"border-t",children:(0,a.jsxs)(Y.XI,{children:[(0,a.jsx)(Y.A0,{children:(0,a.jsxs)(Y.Hj,{children:[(0,a.jsx)(Y.nd,{children:"Quantity"}),(0,a.jsx)(Y.nd,{className:"text-right",children:"Unit Price"}),(0,a.jsx)(Y.nd,{className:"text-right hidden sm:table-cell",children:"Cost Price"}),(0,a.jsx)(Y.nd,{children:"Expiration Date"}),(0,a.jsx)(Y.nd,{className:"hidden sm:table-cell",children:"Form"}),(0,a.jsx)(Y.nd,{className:"hidden sm:table-cell",children:"Route"}),(0,a.jsx)(Y.nd,{className:"hidden lg:table-cell",children:"Status"}),(0,a.jsx)(Y.nd,{className:"hidden md:table-cell",children:"Added Date"})]})}),(0,a.jsx)(Y.BF,{children:("expiration_asc"===J||"expiration_desc"===J?eq(e.stocks):e.stocks).map(e=>{let t=em(e.stockDetails.expirationDate),s=ej(e.productData.medicineData,"form"),n=ej(e.productData.medicineData,"route");return(0,a.jsxs)(Y.Hj,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>{f(e),O(!0)},children:[(0,a.jsx)(Y.nA,{children:e.stockDetails.quantity}),(0,a.jsxs)(Y.nA,{className:"text-right",children:[e.stockDetails.unitPrice.toFixed(2)," Rwf"]}),(0,a.jsxs)(Y.nA,{className:"text-right hidden sm:table-cell",children:[e.stockDetails.costPrice.toFixed(2)," Rwf"]}),(0,a.jsx)(Y.nA,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.stockDetails.expirationDate?new Date(e.stockDetails.expirationDate).toLocaleDateString():"-",t.isExpiring&&(0,a.jsx)(Z.Bc,{children:(0,a.jsxs)(Z.m_,{children:[(0,a.jsx)(Z.k$,{children:(0,a.jsx)(I.A,{className:"h-4 w-4 text-red-500"})}),(0,a.jsx)(Z.ZI,{children:(0,a.jsx)("p",{children:t.message})})]})})]})}),(0,a.jsx)(Y.nA,{className:"hidden sm:table-cell",children:s||"-"}),(0,a.jsx)(Y.nA,{className:"hidden sm:table-cell",children:n||"-"}),(0,a.jsx)(Y.nA,{className:"hidden lg:table-cell",children:(0,a.jsx)(h.E,{className:eb(e.status),children:e.status})}),(0,a.jsx)(Y.nA,{className:"hidden md:table-cell",children:new Date(e.metadata.createdAt).toLocaleDateString()})]},e.id)})})]})})]},e.productId)})}):(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(Y.XI,{children:[(0,a.jsx)(Y.A0,{children:(0,a.jsxs)(Y.Hj,{children:[(0,a.jsx)(Y.nd,{children:"Product"}),(0,a.jsx)(Y.nd,{className:"hidden sm:table-cell",children:"Type"}),(0,a.jsx)(Y.nd,{className:"text-right",children:"Unit Price"}),(0,a.jsx)(Y.nd,{className:"text-right hidden sm:table-cell",children:"Cost Price"}),(0,a.jsx)(Y.nd,{children:"Expiration Date"}),(0,a.jsx)(Y.nd,{className:"hidden sm:table-cell",children:"Form"}),(0,a.jsx)(Y.nd,{className:"hidden sm:table-cell",children:"Route"}),(0,a.jsx)(Y.nd,{className:"hidden lg:table-cell",children:"Status"}),(0,a.jsx)(Y.nd,{className:"hidden md:table-cell",children:"Added Date"})]})}),(0,a.jsx)(Y.BF,{children:eC&&eq(eC).map(e=>{let t=em(e.stockDetails.expirationDate),s=ej(e.productData.medicineData,"form"),n=ej(e.productData.medicineData,"route");return(0,a.jsxs)(Y.Hj,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>{f(e),O(!0)},children:[(0,a.jsx)(Y.nA,{className:"font-medium",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[ex(e.productReference.productType),eO(e)]})}),(0,a.jsx)(Y.nA,{className:"hidden sm:table-cell",children:(0,a.jsx)(h.E,{className:eh(e.productReference.productType),children:el(e.productReference.productType)})}),(0,a.jsxs)(Y.nA,{className:"text-right",children:[e.stockDetails.unitPrice.toFixed(2)," Rwf"]}),(0,a.jsxs)(Y.nA,{className:"text-right hidden sm:table-cell",children:[e.stockDetails.costPrice.toFixed(2)," Rwf"]}),(0,a.jsx)(Y.nA,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.stockDetails.expirationDate?new Date(e.stockDetails.expirationDate).toLocaleDateString():"-",t.isExpiring&&(0,a.jsx)(Z.Bc,{children:(0,a.jsxs)(Z.m_,{children:[(0,a.jsx)(Z.k$,{children:(0,a.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full"})}),(0,a.jsx)(Z.ZI,{children:(0,a.jsx)("p",{children:t.message})})]})})]})}),(0,a.jsx)(Y.nA,{className:"hidden sm:table-cell",children:s||"-"}),(0,a.jsx)(Y.nA,{className:"hidden sm:table-cell",children:n||"-"}),(0,a.jsx)(Y.nA,{className:"hidden lg:table-cell",children:(0,a.jsx)(h.E,{className:eb(e.status),children:e.status})}),(0,a.jsx)(Y.nA,{className:"hidden md:table-cell",children:new Date(e.metadata.createdAt).toLocaleDateString()})]},e.id)})})]})})]})}),(0,a.jsx)(k.lG,{open:S,onOpenChange:O,children:(0,a.jsxs)(k.Cf,{className:"sm:max-w-[800px] max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)(k.c7,{children:[(0,a.jsx)(k.L3,{children:"Product Details"}),(0,a.jsx)(k.rr,{children:"Detailed information about the selected product and stock entry"})]}),g&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Product Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Product Name"}),(0,a.jsx)("p",{className:"text-sm",children:eO(g)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Product Type"}),(0,a.jsx)("p",{className:"text-sm",children:el(g.productReference.productType)})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Stock Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Quantity"}),(0,a.jsx)("p",{className:"text-sm",children:g.stockDetails.quantity})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Original Quantity"}),(0,a.jsx)("p",{className:"text-sm",children:g.stockDetails.originalQuantity})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Unit Price"}),(0,a.jsxs)("p",{className:"text-sm",children:[g.stockDetails.unitPrice.toFixed(2)," Rwf"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Cost Price"}),(0,a.jsxs)("p",{className:"text-sm",children:[g.stockDetails.costPrice.toFixed(2)," Rwf"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Entry Date"}),(0,a.jsx)("p",{className:"text-sm",children:new Date(g.stockDetails.entryDate).toLocaleString()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Expiration Date"}),(0,a.jsx)("p",{className:"text-sm",children:g.stockDetails.expirationDate?new Date(g.stockDetails.expirationDate).toLocaleDateString():"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Batch Number"}),(0,a.jsx)("p",{className:"text-sm",children:g.stockDetails.batchNumber||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Status"}),(0,a.jsx)(h.E,{className:eb(g.status),children:g.status})]})]})]}),"MEDICINE"===g.productReference.sourceService&&g.productData.medicineData&&(0,a.jsxs)("div",{className:"space-y-4",children:["MEDICINE_BRAND"===g.productData.medicineData.productType&&g.productData.medicineData.brandDetails&&(0,a.jsxs)("div",{className:"space-y-2 border rounded p-4 bg-muted/30",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Brand Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Brand Name"}),(0,a.jsx)("p",{className:"text-sm",children:g.productData.medicineData.brandDetails.brandName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Manufacturer"}),(0,a.jsx)("p",{className:"text-sm",children:g.productData.medicineData.brandDetails.manufacturer})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Country"}),(0,a.jsx)("p",{className:"text-sm",children:g.productData.medicineData.brandDetails.country})]})]})]}),(()=>{var e;let t=g.productData.medicineData,s=null;return("MEDICINE_BRAND"===t.productType&&(null==(e=t.brandDetails)?void 0:e.variant)?s=t.brandDetails.variant:"MEDICINE_VARIANT"===t.productType&&t.variantDetails&&(s=t.variantDetails),s)?(0,a.jsxs)("div",{className:"space-y-2 border rounded p-4 bg-muted/30",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Variant Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Form"}),(0,a.jsx)("p",{className:"text-sm",children:s.form})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Route"}),(0,a.jsx)("p",{className:"text-sm",children:s.route})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Strength"}),(0,a.jsx)("p",{className:"text-sm",children:s.strength})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Concentration"}),(0,a.jsx)("p",{className:"text-sm",children:s.concentration})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Packaging"}),(0,a.jsx)("p",{className:"text-sm",children:s.packaging})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Notes"}),(0,a.jsx)("p",{className:"text-sm",children:s.notes})]}),s.generics&&s.generics.length>0&&(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Generics"}),(0,a.jsx)("ul",{className:"list-disc ml-5",children:s.generics.map(e=>(0,a.jsxs)("li",{children:[(0,a.jsx)("b",{children:e.name}),e.chemicalName?" (".concat(e.chemicalName,")"):"",e.therapeuticClass&&(0,a.jsxs)("span",{className:"ml-2 text-xs text-muted-foreground",children:["Class: ",e.therapeuticClass.name]}),e.description&&(0,a.jsxs)("span",{className:"ml-2 text-xs text-muted-foreground",children:["- ",e.description]})]},e.id))})]}),g.productData.medicineData.insuranceCoverages&&g.productData.medicineData.insuranceCoverages.length>0&&(0,a.jsx)(eg,{coverages:g.productData.medicineData.insuranceCoverages,label:"Medicine Insurance Coverages"}),"MEDICINE_BRAND"===g.productData.medicineData.productType&&g.productData.medicineData.brandDetails&&(0,a.jsx)(eg,{coverages:g.productData.medicineData.brandDetails.insuranceCoverages,label:"Brand Insurance Coverages"})]})]}):null})(),(()=>{var e,t;let s=g.productData.medicineData;if("MEDICINE_BRAND"!==s.productType||!(null==(t=s.brandDetails)||null==(e=t.variant)?void 0:e.generics))return null;let n=s.brandDetails.variant.generics.find(e=>e.isParent&&e.variantDetails);if(!n||!n.variantDetails)return null;let r=n.variantDetails;return(0,a.jsxs)("div",{className:"space-y-2 border rounded p-4 bg-muted/30",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Parent Variant Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Form"}),(0,a.jsx)("p",{className:"text-sm",children:r.form})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Route"}),(0,a.jsx)("p",{className:"text-sm",children:r.route})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Strength"}),(0,a.jsx)("p",{className:"text-sm",children:r.strength})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Concentration"}),(0,a.jsx)("p",{className:"text-sm",children:r.concentration})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Packaging"}),(0,a.jsx)("p",{className:"text-sm",children:r.packaging})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Notes"}),(0,a.jsx)("p",{className:"text-sm",children:r.notes})]}),r.generics&&r.generics.length>0&&(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Generics"}),(0,a.jsx)("ul",{className:"list-disc ml-5",children:r.generics.map(e=>(0,a.jsxs)("li",{children:[(0,a.jsx)("b",{children:e.name}),e.chemicalName?" (".concat(e.chemicalName,")"):"",e.therapeuticClass&&(0,a.jsxs)("span",{className:"ml-2 text-xs text-muted-foreground",children:["Class: ",e.therapeuticClass.name]}),e.description&&(0,a.jsxs)("span",{className:"ml-2 text-xs text-muted-foreground",children:["- ",e.description]})]},e.id))})]})]})]})})()]}),"CATALOG"===g.productReference.sourceService&&g.productData.catalogProductData&&(0,a.jsxs)("div",{className:"space-y-4 border rounded p-4 bg-muted/30",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Catalog Product Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Product Name"}),(0,a.jsx)("p",{className:"text-sm",children:g.productData.catalogProductData.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Product Type"}),(0,a.jsx)("p",{className:"text-sm",children:g.productData.catalogProductData.productType})]}),(()=>{let e=g.productData.catalogProductData.productVariant;return e?(0,a.jsxs)(a.Fragment,{children:[e.sku&&(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"SKU"}),(0,a.jsx)("p",{className:"text-sm",children:e.sku})]}),e.brand&&(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Brand"}),(0,a.jsx)("p",{className:"text-sm",children:e.brand})]}),e.weight&&(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Weight"}),(0,a.jsx)("p",{className:"text-sm",children:eN(e.weight)})]}),e.unitOfMeasure&&(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Unit of Measure"}),(0,a.jsx)("p",{className:"text-sm",children:e.unitOfMeasure})]}),e.color&&(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Color"}),(0,a.jsx)("p",{className:"text-sm",children:e.color})]}),e.specifications&&Object.keys(e.specifications).length>0&&(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Specifications"}),(0,a.jsx)("ul",{className:"list-disc ml-5",children:Object.entries(e.specifications).map(e=>{let[t,s]=e;return(0,a.jsxs)("li",{children:[(0,a.jsx)("b",{children:t}),": ",s]},t)})})]})]}):null})()]})]}),g.productData.medicineData&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-md font-semibold",children:"Insurance Coverages"}),(0,a.jsxs)("div",{className:"space-y-3",children:[g.productData.medicineData.insuranceCoverages&&g.productData.medicineData.insuranceCoverages.length>0&&(0,a.jsx)(eg,{coverages:g.productData.medicineData.insuranceCoverages,label:"Medicine Insurance Coverages"}),"MEDICINE_BRAND"===g.productData.medicineData.productType&&g.productData.medicineData.brandDetails&&(0,a.jsx)(eg,{coverages:g.productData.medicineData.brandDetails.insuranceCoverages,label:"Brand Insurance Coverages"})]})]}),"MEDICINE"===g.productReference.sourceService&&g.productData.medicineData&&(()=>{var e,t;let s=g.productData.medicineData,n=(null==(e=s.variantDetails)?void 0:e.insuranceCoverages)||[],r=(null==(t=s.brandDetails)?void 0:t.insuranceCoverages)||[];return(0,a.jsxs)("div",{className:"space-y-4",children:[n.length>0&&(0,a.jsx)(eg,{coverages:n,label:"Variant Insurance Coverages"}),r.length>0&&(0,a.jsx)(eg,{coverages:r,label:"Brand Insurance Coverages"})]})})(),"CATALOG"===g.productReference.sourceService&&g.productData.catalogProductData&&(()=>{let e=g.productData.catalogProductData,t=e.productVariant||void 0,s=e.productFamily||void 0,n=(null==t?void 0:t.insuranceCoverages)||[],r=(null==s?void 0:s.insuranceCoverages)||[];return(0,a.jsxs)("div",{className:"space-y-4",children:[n.length>0&&(0,a.jsx)(eg,{coverages:n,label:"Product Variant Insurance Coverages"}),r.length>0&&(0,a.jsx)(eg,{coverages:r,label:"Product Family Insurance Coverages"})]})})()]})]})}),(0,a.jsx)(k.lG,{open:eU,onOpenChange:eJ,children:(0,a.jsxs)(k.Cf,{className:"sm:max-w-[500px]",children:[(0,a.jsxs)(k.c7,{children:[(0,a.jsx)(k.L3,{children:"Product Details"}),(0,a.jsx)(k.rr,{children:"Detailed information about the selected product or medicine"})]}),eV&&(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsx)("div",{className:"font-semibold text-lg",children:eV.data.name}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground mb-2",children:[eV.domain," - ",eV.type]}),eV.data.description&&(0,a.jsx)("div",{children:eV.data.description}),"medicine"===eV.domain&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:["Form: ",(0,a.jsx)("b",{children:eV.data.form})]}),(0,a.jsxs)("div",{children:["Route: ",(0,a.jsx)("b",{children:eV.data.route})]}),(0,a.jsxs)("div",{children:["Strength: ",(0,a.jsx)("b",{children:eV.data.strength})]}),(0,a.jsxs)("div",{children:["Manufacturer: ",(0,a.jsx)("b",{children:eV.data.manufacturer})]}),eV.data.additionalInfo&&(0,a.jsxs)("div",{children:["Additional Info: ",eV.data.additionalInfo]}),eV.data.insuranceCoverages&&eV.data.insuranceCoverages.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium mt-2",children:"Insurance Coverages:"}),(0,a.jsx)("ul",{className:"list-disc ml-5",children:eV.data.insuranceCoverages.map(e=>(0,a.jsxs)("li",{children:[(0,a.jsx)("b",{children:e.insuranceName}),void 0!==e.insurancePrice&&(0,a.jsxs)(a.Fragment,{children:[" - Price: ",e.insurancePrice," Rwf"]}),void 0!==e.clientContributionPercentage&&(0,a.jsxs)(a.Fragment,{children:[" | Client: ",e.clientContributionPercentage,"%"]}),e.requiresPreApproval&&(0,a.jsx)("span",{className:"ml-2 text-xs text-muted-foreground",children:"(Pre-approval required)"})]},e.id))})]})]}),"catalog"===eV.domain&&(0,a.jsxs)(a.Fragment,{children:[eV.data.sku&&(0,a.jsxs)("div",{children:["SKU: ",(0,a.jsx)("b",{children:eV.data.sku})]}),eV.data.brand&&(0,a.jsxs)("div",{children:["Brand: ",(0,a.jsx)("b",{children:eV.data.brand})]}),eV.data.manufacturer&&(0,a.jsxs)("div",{children:["Manufacturer: ",(0,a.jsx)("b",{children:eV.data.manufacturer})]}),eV.data.status&&(0,a.jsxs)("div",{children:["Status: ",(0,a.jsx)("b",{children:eV.data.status})]}),eV.data.category&&eV.data.category.name&&(0,a.jsxs)("div",{children:["Category: ",(0,a.jsx)("b",{children:eV.data.category.name})]}),eV.data.shortDescription&&(0,a.jsxs)("div",{children:["Short Description: ",eV.data.shortDescription]}),"PRODUCT_VARIANT"===eV.type&&ef(eV.data)&&(0,a.jsxs)(a.Fragment,{children:[eV.data.weight&&(0,a.jsxs)("div",{children:["Weight: ",(0,a.jsx)("b",{children:eN(eV.data.weight)})]}),eV.data.unitOfMeasure&&(0,a.jsxs)("div",{children:["Unit of Measure: ",(0,a.jsx)("b",{children:eV.data.unitOfMeasure})]}),eV.data.color&&(0,a.jsxs)("div",{children:["Color: ",(0,a.jsx)("b",{children:eV.data.color})]}),eV.data.specifications&&Object.keys(eV.data.specifications).length>0&&(0,a.jsxs)("div",{children:["Specifications:",(0,a.jsx)("ul",{className:"list-disc ml-5",children:Object.entries(eV.data.specifications).map(e=>{let[t,s]=e;return(0,a.jsxs)("li",{children:[(0,a.jsx)("b",{children:t}),": ",s]},t)})})]}),eV.data.insuranceCoverages&&eV.data.insuranceCoverages.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium mt-2",children:"Insurance Coverages:"}),(0,a.jsx)("ul",{className:"list-disc ml-5",children:eV.data.insuranceCoverages.map(e=>(0,a.jsxs)("li",{children:[(0,a.jsx)("b",{children:e.insuranceName}),void 0!==e.insurancePrice&&(0,a.jsxs)(a.Fragment,{children:[" - Price: ",e.insurancePrice," Rwf"]}),void 0!==e.clientContributionPercentage&&(0,a.jsxs)(a.Fragment,{children:[" | Client: ",e.clientContributionPercentage,"%"]}),e.requiresPreApproval&&(0,a.jsx)("span",{className:"ml-2 text-xs text-muted-foreground",children:"(Pre-approval required)"})]},e.id))})]})]})]})]})]})})]})}function eb(e){switch(e){case"ACTIVE":return"bg-green-100 text-green-800";case"INACTIVE":return"bg-yellow-100 text-yellow-800";case"EXPIRED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}var ey=s(99335),ew=s(17018),eD=s(75452),eC=s(32610),eI=s(56353),ek=s(77826),eP=s(57083);let eA=O.Ik({patientName:O.Yj().min(1,"Patient name is required"),patientContact:O.Yj().min(1,"Patient contact is required"),insuranceId:O.Yj().min(1,"Insurance is required"),insuranceCoverage:O.ai().min(0).max(100,"Coverage must be between 0 and 100"),customInsuranceName:O.Yj().optional(),insuranceCardNumber:O.Yj().optional(),principalMemberName:O.Yj().optional(),prescriberName:O.Yj().min(1,"Prescriber name is required"),prescriberOrganization:O.Yj().min(1,"Prescriber organization is required"),prescriberContact:O.Yj().min(1,"Prescriber contact is required"),prescriberType:O.Yj().min(1,"Prescriber type is required"),prescriberLicenseNumber:O.Yj().min(1,"Prescriber license number is required"),stockId:O.Yj().min(1,"Stock item is required"),quantity:O.ai().min(1,"Quantity must be at least 1"),paymentMode:O.Yj().min(1,"Payment mode is required"),notes:O.Yj().optional()}),eS=e=>{var t,s;return"MEDICINE"===e.productReference.sourceService?(null==(t=e.productData.medicineData)?void 0:t.name)||"Unknown Medicine":(null==(s=e.productData.catalogProductData)?void 0:s.name)||"Unknown Product"},eE=e=>{switch(e){case"MEDICINE_GENERIC":case"CATALOG_PRODUCT_FAMILY":return"bg-green-100 text-green-800";case"MEDICINE_VARIANT":case"CATALOG_PRODUCT_VARIANT":return"bg-purple-100 text-purple-800";case"MEDICINE_BRAND":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},eT=e=>{switch(e){case"MEDICINE_GENERIC":return"Generic Medicine";case"MEDICINE_BRAND":return"Brand Medicine";case"MEDICINE_VARIANT":return"Medicine Variant";case"CATALOG_PRODUCT_FAMILY":return"Product Family";case"CATALOG_PRODUCT_VARIANT":return"Product Variant";default:return e}};function eR(e){if(!e||!e.productData)return[];if("MEDICINE"===e.productData.sourceService){var t;let s=null==(t=e.productData.medicineData)?void 0:t.variantDetails;if(s&&Array.isArray(s.insuranceCoverages))return s.insuranceCoverages;let a=e.productData.medicineData;if(a&&Array.isArray(a.insuranceCoverages))return a.insuranceCoverages}else if("CATALOG"===e.productData.sourceService){let t=e.productData.catalogProductData;if(t&&t.productVariant&&Array.isArray(t.productVariant.insuranceCoverages))return t.productVariant.insuranceCoverages}return[]}function eF(e,t){return e&&t?eR(e).find(e=>e.insuranceId===t):null}function eM(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e?"number"==typeof e.coveragePercentage?e.coveragePercentage:"number"==typeof e.clientContributionPercentage?e.clientContributionPercentage:"number"==typeof e.coverage?e.coverage:t:t}let eO=e=>{switch(e){case"MEDICINE_GENERIC":case"CATALOG_PRODUCT_FAMILY":default:return(0,a.jsx)(j.A,{className:"h-4 w-4"});case"MEDICINE_VARIANT":case"CATALOG_PRODUCT_VARIANT":return(0,a.jsx)(g.A,{className:"h-4 w-4"});case"MEDICINE_BRAND":return(0,a.jsx)(f.A,{className:"h-4 w-4"})}};function e_(e){var t,s,n,r,i,c;let{selectedStock:l,searchTerm:o,onSearchChange:d,onStockSelect:u,onStockChange:x,stockSearchData:j,isStockSearchLoading:g,selectedInsuranceId:f,selectedInsuranceName:N,cartItems:v}=e,y=N||(f?"private"===f?"Private Insurance":"other"===f?"Custom Insurance":null:null),w=l?eR(l):[],D=l&&f?eF(l,f):null;l&&f&&(console.log("=== Insurance Coverage Debug ==="),console.log("Selected Insurance ID:",f),console.log("Selected Insurance Name:",y),console.log("Product Insurance Coverages:",null==w?void 0:w.map(e=>({id:e.id,insuranceId:e.insuranceId,insuranceName:e.insuranceName,coveragePercentage:e.coveragePercentage}))),console.log("Matching Coverage Found:",D?"YES":"NO"),D&&console.log("Matched Coverage Details:",D),console.log("================================"));let C=f&&"private"!==f&&"other"!==f&&w.length>0&&!D,I=null==j?void 0:j.content.filter(e=>!v.some(t=>t.stock.id===e.id)),k=e=>{if(!f||"private"===f)return!0;if("other"===f)return!1;let t=eR(e);return 0!==t.length&&t.some(e=>e.insuranceId===f)};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Stock Item"}),l?(0,a.jsxs)("div",{className:"border rounded-lg p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[eO(l.productReference.productType),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:eS(l)}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Available: ",l.stockDetails.quantity," | Price: $",l.stockDetails.unitPrice.toFixed(2)]})]})]}),(0,a.jsx)(p.$,{type:"button",variant:"ghost",size:"sm",onClick:x,children:"Change"})]}),l.productData.medicineData&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(null==(t=l.productData.medicineData.variantDetails)?void 0:t.form)&&(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Form"}),(0,a.jsx)("p",{children:l.productData.medicineData.variantDetails.form})]}),(null==(s=l.productData.medicineData.variantDetails)?void 0:s.route)&&(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Route"}),(0,a.jsx)("p",{children:l.productData.medicineData.variantDetails.route})]}),(null==(n=l.productData.medicineData.variantDetails)?void 0:n.strength)&&(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Strength"}),(0,a.jsx)("p",{children:l.productData.medicineData.variantDetails.strength})]}),(null==(r=l.productData.medicineData.variantDetails)?void 0:r.concentration)&&(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Concentration"}),(0,a.jsx)("p",{children:l.productData.medicineData.variantDetails.concentration})]}),D&&(0,a.jsxs)("div",{className:"col-span-2 space-y-3 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded-lg",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(h.E,{variant:"outline",className:"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300 border-green-300 dark:border-green-600",children:"Insurance Coverage Available"})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Coverage Percentage"}),(0,a.jsxs)("p",{className:"font-medium",children:[eM(D),"%"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Insurance Price"}),(0,a.jsxs)("p",{className:"font-medium",children:["number"==typeof D.insurancePrice?"$".concat(D.insurancePrice.toFixed(2)):"N/A","number"==typeof D.insurancePrice&&(0,a.jsx)("span",{className:"block text-xs text-muted-foreground",children:"(This price will be used for calculation if coverage matches)"})]})]}),D.notes&&(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)(A.J,{className:"text-sm font-medium text-muted-foreground",children:"Notes"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:D.notes})]})]})]}),(C||"other"===f)&&"private"!==f&&(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsx)(Z.Bc,{children:(0,a.jsxs)(Z.m_,{children:[(0,a.jsx)(Z.k$,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg",children:[(0,a.jsx)(eI.A,{className:"h-4 w-4 text-yellow-600 dark:text-yellow-400"}),(0,a.jsx)("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-300",children:"other"===f?"Custom: Check Coverage":"Insurance Not Supported"})]})}),(0,a.jsx)(Z.ZI,{children:(0,a.jsx)("p",{className:"max-w-xs",children:"other"===f?"Custom insurance selected. Please ensure this insurance covers the selected product.":"This product is not covered by the selected insurance. Supported insurances: ".concat(null==(c=l.productData.medicineData)||null==(i=c.insuranceCoverages)?void 0:i.map(e=>e.insuranceName).join(", "))})})]})})})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(b.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(m.p,{placeholder:"Search stock items...",value:o,onChange:e=>d(e.target.value),className:"pl-10"})]}),o.trim().length>0&&(0,a.jsx)("div",{className:"max-h-[300px] overflow-y-auto space-y-2",children:g?(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Searching..."})]}):(null==I?void 0:I.length)===0?(0,a.jsx)("div",{className:"text-center py-4",children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:(null==j?void 0:j.content.length)===0?"No results found":"All matching products are already in cart"})}):null==I?void 0:I.map(e=>{var t,s;eR(e);let n=f?eF(e,f):null;return n&&console.log("Stock search result matchingCoverage:",n),(0,a.jsxs)("div",{className:"border rounded-lg p-4 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>u(e),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[eO(e.productReference.productType),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:eS(e)}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Quantity: ",e.stockDetails.quantity," | Price: ",e.stockDetails.unitPrice.toFixed(2)," Rwf"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.E,{className:eE(e.productReference.productType),children:eT(e.productReference.productType)}),"private"===f&&(0,a.jsx)(h.E,{variant:"outline",className:"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300 border-blue-300 dark:border-blue-600 flex items-center gap-1",children:"Private Insurance"}),n&&"private"!==f&&(0,a.jsx)(h.E,{variant:"outline",className:"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300 border-green-300 dark:border-green-600 flex items-center gap-1",children:"Insurance Coverage Available"}),!k(e)&&"private"!==f&&(0,a.jsx)(Z.Bc,{children:(0,a.jsxs)(Z.m_,{children:[(0,a.jsx)(Z.k$,{asChild:!0,children:(0,a.jsxs)(h.E,{variant:"outline",className:"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-300 border-yellow-300 dark:border-yellow-600 flex items-center gap-1",children:[(0,a.jsx)(eI.A,{className:"h-3 w-3 mr-1"}),"other"===f?"Custom: Check Coverage":"Insurance Not Supported"]})}),(0,a.jsx)(Z.ZI,{children:(0,a.jsx)("p",{className:"max-w-xs",children:"other"===f?"Custom insurance selected. Please ensure this insurance covers the selected product.":"This product is not covered by the selected insurance. Supported insurances: ".concat(null==(s=e.productData.medicineData)||null==(t=s.insuranceCoverages)?void 0:t.map(e=>e.insuranceName).join(", "))})})]})})]})]}),n&&(0,a.jsx)("div",{className:"mt-2 p-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded",children:(0,a.jsxs)("div",{className:"flex gap-4 text-xs",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"Coverage %:"})," ",eM(n),"%"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"Insurance Price:"})," ","number"==typeof n.insurancePrice?"".concat(n.insurancePrice.toFixed(2)," Rwf"):"N/A"]})]})})]},e.id)})})]})]})}var eL=s(95788),eq=s(50239);function eV(e){let{form:t}=e,{insurances:s,isLoading:n,error:r}=(0,eq.Z)(),i=e=>{if(t.setValue("insuranceId",e),"private"===e)t.setValue("insuranceCoverage",100),t.setValue("customInsuranceName",""),t.setValue("insuranceCardNumber",""),t.setValue("principalMemberName","");else if("other"===e)t.setValue("insuranceCoverage",0),t.setValue("customInsuranceName",""),t.setValue("insuranceCardNumber",""),t.setValue("principalMemberName","");else{let a=Array.isArray(s)?s.find(t=>t.id===e):void 0;if(a&&null!==a.defaultClientContributionPercentage){let e=100-a.defaultClientContributionPercentage;t.setValue("insuranceCoverage",e)}else t.setValue("insuranceCoverage",0);t.setValue("customInsuranceName",""),t.setValue("insuranceCardNumber",""),t.setValue("principalMemberName","")}},c=e=>{t.setValue("insuranceCoverage",e)};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Patient Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(z,{control:t.control,name:"patientName",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Patient Name"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{...t})}),(0,a.jsx)(Q,{})]})}}),(0,a.jsx)(z,{control:t.control,name:"patientContact",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Contact Number"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{...t})}),(0,a.jsx)(Q,{})]})}}),(0,a.jsx)(z,{control:t.control,name:"insuranceId",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Insurance"}),(0,a.jsxs)(eL.l6,{value:t.value,onValueChange:i,disabled:n,children:[(0,a.jsx)(G,{children:(0,a.jsx)(eL.bq,{children:(0,a.jsx)(eL.yv,{placeholder:n?"Loading insurances...":"Select insurance"})})}),(0,a.jsxs)(eL.gC,{children:[(0,a.jsx)(eL.eb,{value:"private",children:"Private (100% Coverage)"}),Array.isArray(s)&&s.map(e=>(0,a.jsxs)(eL.eb,{value:e.id,children:[e.name,e.abbreviation&&" (".concat(e.abbreviation,")"),null!==e.defaultClientContributionPercentage&&" - ".concat(100-e.defaultClientContributionPercentage,"% coverage")]},e.id)),(0,a.jsx)(eL.eb,{value:"other",children:"Other (Custom Insurance)"})]})]}),(0,a.jsx)(Q,{})]})}}),"other"===t.watch("insuranceId")&&(0,a.jsx)(z,{control:t.control,name:"customInsuranceName",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Custom Insurance Name"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{...t,placeholder:"Enter insurance name"})}),(0,a.jsx)(Q,{})]})}}),t.watch("insuranceId")&&"private"!==t.watch("insuranceId")&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(z,{control:t.control,name:"principalMemberName",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{className:"md:col-span-2",children:[(0,a.jsx)(B,{children:"Principal Member Name"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{...t,placeholder:"Enter principal member name"})}),(0,a.jsx)(Q,{})]})}}),(0,a.jsx)(z,{control:t.control,name:"insuranceCoverage",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Insurance Coverage (%)"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{type:"number",min:0,max:100,...t,onChange:e=>c(Number(e.target.value))})}),(0,a.jsx)(Q,{})]})}}),(0,a.jsx)(z,{control:t.control,name:"insuranceCardNumber",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Insurance Card Number"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{...t,placeholder:"Enter insurance card number"})}),(0,a.jsx)(Q,{})]})}})]})]})]})}var ez=s(38243),eU=s(94402);let eJ=["Ophthalmologist","Dentist","General Practitioner","Cardiologist","Pediatrician","Dermatologist","Neurologist","Orthopedic","Gynecologist","ENT Specialist","Psychiatrist","Urologist","Endocrinologist","Gastroenterologist","Pulmonologist","Rheumatologist","Oncologist","Nephrologist","Hematologist","Infectious Disease Specialist","Ophthalamic Clinical Officer","Nurse","Pharmacist","Pharmacy Technician","Pharmacy Assistant","Pharmacy Manager","Pharmacy Director","Pharmacy Consultant"];var e$=s(20169);function eB(e){let{form:t}=e,[s,r]=(0,n.useState)(""),c=""===s?eJ:eJ.filter(e=>e.toLowerCase().includes(s.toLowerCase()));return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Prescriber Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(z,{control:t.control,name:"prescriberName",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Prescriber Name"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{...t})}),(0,a.jsx)(Q,{})]})}}),(0,a.jsx)(z,{control:t.control,name:"prescriberLicenseNumber",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"License Number"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{...t})}),(0,a.jsx)(Q,{})]})}}),(0,a.jsx)(z,{control:t.control,name:"prescriberOrganization",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Organization"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{...t})}),(0,a.jsx)(Q,{})]})}}),(0,a.jsx)(z,{control:t.control,name:"prescriberContact",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Contact Number"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{...t})}),(0,a.jsx)(Q,{})]})}}),(0,a.jsx)(z,{control:t.control,name:"prescriberType",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Specialization"}),(0,a.jsx)(G,{children:(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)(e$.G3,{as:"div",value:t.value,onChange:e=>{t.onChange(e),r("")},children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(e$.G3.Input,{className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",onChange:e=>r(e.target.value),placeholder:"Select specialization",displayValue:e=>e}),(0,a.jsx)(e$.G3.Button,{className:"absolute inset-y-0 right-0 flex items-center pr-2",children:(0,a.jsx)(ez.A,{className:"h-4 w-4 opacity-50","aria-hidden":"true"})})]}),(0,a.jsx)(e$.G3.Options,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-popover py-1 text-popover-foreground shadow-md ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:0===c.length&&""!==s?(0,a.jsx)("div",{className:"relative cursor-default select-none py-2 px-4 text-muted-foreground",children:(0,a.jsxs)(p.$,{type:"button",variant:"outline",className:"w-full justify-start",onClick:e=>{e.preventDefault();let s=prompt("Enter custom specialization:");s&&(t.onChange(s),r(""))},children:[(0,a.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Add custom specialization"]})}):c.map(e=>(0,a.jsx)(e$.G3.Option,{value:e,className:e=>{let{active:t}=e;return(0,i.cn)("relative cursor-default select-none py-2 pl-10 pr-4",t?"bg-accent text-accent-foreground":"text-foreground")},children:t=>{let{selected:s,active:n}=t;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:(0,i.cn)("block truncate",s?"font-medium":"font-normal"),children:e}),s&&(0,a.jsx)("span",{className:(0,i.cn)("absolute inset-y-0 left-0 flex items-center pl-3",n?"text-accent-foreground":"text-primary"),children:(0,a.jsx)(eU.A,{className:"h-4 w-4","aria-hidden":"true"})})]})}},e))})]})})}),(0,a.jsx)(Q,{})]})}})]})]})}var eG=s(14717),eQ=s(98921),eY=s(12468);function eZ(e){let{sale:t,isOpen:s,onClose:n}=e;if(!t)return null;let r=e=>"".concat(e.toLocaleString("en-RW",{minimumFractionDigits:2,maximumFractionDigits:2})," Rwf");return(0,a.jsx)(k.lG,{open:s,onOpenChange:n,children:(0,a.jsxs)(k.Cf,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)(k.c7,{children:[(0,a.jsx)(k.L3,{children:"Sale Details"}),(0,a.jsxs)(k.rr,{children:["Transaction ID: ",t.id]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-sm text-muted-foreground",children:"Transaction Date"}),(0,a.jsx)("p",{className:"text-sm",children:new Date(t.transactionDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-sm text-muted-foreground",children:"Payment Mode"}),(0,a.jsx)(h.E,{variant:"secondary",className:"capitalize",children:t.paymentMode.replace("_"," ")})]})]}),(0,a.jsx)(eQ.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-3",children:"Patient Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"text-sm text-muted-foreground",children:"Name"}),(0,a.jsx)("p",{className:"font-medium",children:t.patientName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"text-sm text-muted-foreground",children:"Contact"}),(0,a.jsx)("p",{className:"font-medium",children:t.patientContact})]})]})]}),(0,a.jsx)(eQ.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-3",children:"Prescriber Information"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"text-sm text-muted-foreground",children:"Name"}),(0,a.jsx)("p",{className:"font-medium",children:t.prescriberName}),(0,a.jsx)("h5",{className:"text-sm text-muted-foreground mt-2",children:"License Number"}),(0,a.jsx)("p",{className:"font-medium",children:t.prescriberLicenseNumber||"-"})]})})]}),(0,a.jsx)(eQ.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold mb-3",children:["Items (",t.items.length,")"]}),(0,a.jsx)("div",{className:"space-y-3",children:t.items.map((e,t)=>(0,a.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium",children:e.productName}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Quantity: ",e.quantitySold," \xd7 ",r(e.unitPrice)]}),e.salesnotes&&(0,a.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Note:"})," ",e.salesnotes]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"font-medium",children:r(e.totalAmount)}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:[(0,a.jsxs)("p",{children:["Insurance: ",r(e.insurancePayment)]}),(0,a.jsxs)("p",{children:["Patient: ",r(e.patientPayment)]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.E,{variant:"outline",className:"text-xs",children:e.insuranceName?e.insuranceName:"No Insurance"}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:[e.insuranceCoverage,"% coverage"]})]})]},e.id))})]}),(0,a.jsx)(eQ.w,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total Price:"}),(0,a.jsx)("span",{className:"font-medium",children:r(t.totalPrice)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Insurance Payment:"}),(0,a.jsx)("span",{className:"font-medium text-green-600",children:r(t.totalInsurancePayment)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Patient Payment:"}),(0,a.jsx)("span",{className:"font-medium text-blue-600",children:r(t.totalPatientPayment)})]})]})]})]})})}function eK(e){let{sales:t,onDownloadInvoice:s,isLoading:r}=e,[i,c]=(0,n.useState)("transactionDate"),[l,o]=(0,n.useState)("desc"),[d,u]=(0,n.useState)(""),[x,g]=(0,n.useState)("all"),[f,v]=(0,n.useState)("list"),[y,w]=(0,n.useState)(null),[D,C]=(0,n.useState)(!1),I=(0,n.useMemo)(()=>[...new Set(t.map(e=>{var t;return(null==(t=e.items[0])?void 0:t.insuranceName)||"Unknown"}))].sort(),[t]),k=(0,n.useMemo)(()=>{let e=t.filter(e=>{var t;let s=e.patientName.toLowerCase().includes(d.toLowerCase())||e.patientContact.toLowerCase().includes(d.toLowerCase()),a="all"===x||(null==(t=e.items[0])?void 0:t.insuranceName)===x;return s&&a}).sort((e,t)=>{let s,a;switch(i){case"transactionDate":s=new Date(e.transactionDate).getTime(),a=new Date(t.transactionDate).getTime();break;case"totalPrice":s=e.totalPrice,a=t.totalPrice;break;case"insuranceName":var n,r;s=(null==(n=e.items[0])?void 0:n.insuranceName)||"Unknown",a=(null==(r=t.items[0])?void 0:r.insuranceName)||"Unknown";break;default:s=e.transactionDate,a=t.transactionDate}return"asc"===l?s>a?1:-1:s<a?1:-1});return"categorized"===f?e.reduce((e,t)=>{var s;let a=(null==(s=t.items[0])?void 0:s.insuranceName)||"Unknown";return e[a]||(e[a]=[]),e[a].push(t),e},{}):e},[t,d,x,i,l,f]),P=e=>{i===e?o("asc"===l?"desc":"asc"):(c(e),o("desc"))},A=e=>i!==e?(0,a.jsx)(N.A,{className:"h-4 w-4"}):"asc"===l?(0,a.jsx)(ey.A,{className:"h-4 w-4"}):(0,a.jsx)(ew.A,{className:"h-4 w-4"}),S=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),E=e=>"".concat(e.toLocaleString("en-RW",{minimumFractionDigits:2,maximumFractionDigits:2})," Rwf"),T=e=>{w(e),C(!0)};return r?(0,a.jsx)("div",{className:"space-y-4",children:Array.from({length:5}).map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(eG.E,{className:"h-12 w-12 rounded-full"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eG.E,{className:"h-4 w-[250px]"}),(0,a.jsx)(eG.E,{className:"h-4 w-[200px]"})]})]},t))}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(b.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,a.jsx)(m.p,{placeholder:"Search by patient name or contact...",value:d,onChange:e=>u(e.target.value),className:"pl-10"})]}),(0,a.jsxs)(eL.l6,{value:x,onValueChange:g,children:[(0,a.jsx)(eL.bq,{className:"w-[200px]",children:(0,a.jsx)(eL.yv,{placeholder:"Filter by insurance"})}),(0,a.jsxs)(eL.gC,{children:[(0,a.jsx)(eL.eb,{value:"all",children:"All Insurances"}),I.map(e=>(0,a.jsx)(eL.eb,{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"flex border rounded-md",children:[(0,a.jsx)(p.$,{variant:"list"===f?"default":"ghost",size:"sm",onClick:()=>v("list"),className:"rounded-r-none",children:"List View"}),(0,a.jsx)(p.$,{variant:"categorized"===f?"default":"ghost",size:"sm",onClick:()=>v("categorized"),className:"rounded-l-none",children:"By Insurance"})]})]}),(0,a.jsx)("div",{className:"border rounded-lg overflow-x-auto",children:(0,a.jsxs)(Y.XI,{children:[(0,a.jsx)(Y.A0,{children:(0,a.jsxs)(Y.Hj,{children:[(0,a.jsx)(Y.nd,{className:"w-[180px]",children:(0,a.jsxs)(p.$,{variant:"ghost",onClick:()=>P("transactionDate"),className:"h-auto p-0 font-semibold",children:["Date & Time ",A("transactionDate")]})}),(0,a.jsx)(Y.nd,{className:"w-[200px]",children:"Patient"}),(0,a.jsx)(Y.nd,{className:"w-[150px]",children:(0,a.jsxs)(p.$,{variant:"ghost",onClick:()=>P("insuranceName"),className:"h-auto p-0 font-semibold",children:["Insurance ",A("insuranceName")]})}),(0,a.jsx)(Y.nd,{className:"w-[150px]",children:(0,a.jsxs)(p.$,{variant:"ghost",onClick:()=>P("totalPrice"),className:"h-auto p-0 font-semibold",children:["Total ",A("totalPrice")]})}),(0,a.jsx)(Y.nd,{className:"w-[120px]",children:"Payment"}),(0,a.jsx)(Y.nd,{className:"w-[80px] text-center",children:"Actions"})]})}),(0,a.jsx)(Y.BF,{children:"categorized"===f?Object.entries(k).map(e=>{let[t,r]=e;return(0,a.jsxs)(n.Fragment,{children:[(0,a.jsx)(Y.Hj,{className:"bg-muted/50",children:(0,a.jsxs)(Y.nA,{colSpan:6,className:"font-semibold text-center py-3",children:[t," (",r.length," sales)"]})},"header-".concat(t)),r.map(e=>{var t;return(0,a.jsxs)(Y.Hj,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>T(e),children:[(0,a.jsx)(Y.nA,{className:"py-3",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eD.A,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm whitespace-nowrap",children:S(e.transactionDate)})]})}),(0,a.jsx)(Y.nA,{className:"py-3",children:(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("p",{className:"font-medium truncate",children:e.patientName}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:e.patientContact})]})}),(0,a.jsx)(Y.nA,{className:"py-3",children:(0,a.jsx)(h.E,{variant:"outline",className:"whitespace-nowrap",children:(null==(t=e.items[0])?void 0:t.insuranceName)?e.items[0].insuranceName:"No Insurance"})}),(0,a.jsx)(Y.nA,{className:"py-3",children:(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"font-medium",children:E(e.totalPrice)}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:[(0,a.jsxs)("p",{children:["Insurance: ",E(e.totalInsurancePayment)]}),(0,a.jsxs)("p",{children:["Patient: ",E(e.totalPatientPayment)]})]})]})}),(0,a.jsx)(Y.nA,{className:"py-3",children:(0,a.jsx)(h.E,{variant:"secondary",className:"capitalize whitespace-nowrap",children:e.paymentMode.replace("_"," ")})}),(0,a.jsx)(Y.nA,{className:"py-3 text-center",children:(0,a.jsx)(p.$,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),s(e)},className:"h-8 w-8 p-0",children:(0,a.jsx)(eC.A,{className:"h-4 w-4"})})})]},e.id)})]},t)}):k.map(e=>{var t;return(0,a.jsxs)(Y.Hj,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>T(e),children:[(0,a.jsx)(Y.nA,{className:"py-3",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eD.A,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm whitespace-nowrap",children:S(e.transactionDate)})]})}),(0,a.jsx)(Y.nA,{className:"py-3",children:(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("p",{className:"font-medium truncate",children:e.patientName}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:e.patientContact})]})}),(0,a.jsx)(Y.nA,{className:"py-3",children:(0,a.jsx)(h.E,{variant:"outline",className:"whitespace-nowrap",children:(null==(t=e.items[0])?void 0:t.insuranceName)?e.items[0].insuranceName:"No Insurance"})}),(0,a.jsx)(Y.nA,{className:"py-3",children:(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"font-medium",children:E(e.totalPrice)}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:[(0,a.jsxs)("p",{children:["Insurance: ",E(e.totalInsurancePayment)]}),(0,a.jsxs)("p",{children:["Patient: ",E(e.totalPatientPayment)]})]})]})}),(0,a.jsx)(Y.nA,{className:"py-3",children:(0,a.jsx)(h.E,{variant:"secondary",className:"capitalize whitespace-nowrap",children:e.paymentMode.replace("_"," ")})}),(0,a.jsx)(Y.nA,{className:"py-3 text-center",children:(0,a.jsx)(p.$,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),s(e)},className:"h-8 w-8 p-0",children:(0,a.jsx)(eC.A,{className:"h-4 w-4"})})})]},e.id)})})]})}),(0,a.jsx)(eZ,{sale:y,isOpen:D,onClose:()=>{C(!1),w(null)}}),("categorized"===f&&0===Object.keys(k).length||"list"===f&&0===k.length)&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(j.A,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,a.jsx)("h3",{className:"mt-4 text-lg font-semibold",children:"No sales found"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:d||"all"!==x?"Try adjusting your search or filter criteria.":"Get started by creating your first sale."})]})]})}function eH(){let[e,t]=(0,n.useState)(!1),[s,r]=(0,n.useState)(""),[i,c]=(0,n.useState)(null),[l,o]=(0,n.useState)([]),[d,g]=(0,n.useState)(0),[f,N]=(0,n.useState)(0),[b,y]=(0,n.useState)(0),[w,D]=(0,n.useState)(0),[C,I]=(0,n.useState)(!0),[P,A]=(0,n.useState)(""),[S,E]=(0,n.useState)(""),{insurances:T}=(0,eq.Z)(),R=(0,u.jE)(),{data:O,isLoading:L,error:V}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{page:t=0,size:s=20,sort:a="transactionDate,desc"}=e;return(0,K.I)({queryKey:["sales",t,s,a],queryFn:async()=>{let e=new URLSearchParams({page:t.toString(),size:s.toString(),sort:a}),n=await (0,W.v$)("".concat(W.Sn.inventory.sales,"?").concat(e));if(!n.ok)throw Error("Failed to fetch sales");return n.json()},staleTime:3e5,gcTime:6e5})}({page:w,size:50,sort:"transactionDate,desc"}),U=(0,H.n)({mutationFn:async e=>{if(!e.trim())return{content:[]};let t=await (0,W.v$)("".concat(W.Sn.inventory.base,"/stocks/search?name=").concat(encodeURIComponent(e)));if(!t.ok)throw Error("Failed to fetch stock search results");return t.json()}}),J=(0,H.n)({mutationFn:async e=>{let t=await (0,W.v$)(W.Sn.inventory.sales,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({}))).message||"Failed to create sale");return t.json()}}),Y=async e=>{if(0===l.length)return void _.o.error("You must add at least one product to the sale.");try{let s=null;if("private"===e.insuranceId)s=null;else if("other"===e.insuranceId)s={id:"custom",name:e.customInsuranceName||"Custom Insurance",coverage:e.insuranceCoverage,cardNumber:e.insuranceCardNumber,principalMemberName:e.principalMemberName};else{let t=Array.isArray(T)?T.find(t=>t.id===e.insuranceId):void 0;s={id:e.insuranceId,name:(null==t?void 0:t.name)||"Unknown Insurance",coverage:e.insuranceCoverage,cardNumber:e.insuranceCardNumber,principalMemberName:e.principalMemberName}}let a={patient:{name:e.patientName,contact:e.patientContact,insurance:s},prescriber:{name:e.prescriberName,organization:e.prescriberOrganization,contact:e.prescriberContact,licenseNumber:e.prescriberLicenseNumber,type:e.prescriberType},items:l.map(e=>"private"===e.insuranceId?{stockId:e.stock.id,quantity:e.quantity,unitPrice:e.unitPrice,insuranceCoverage:0,insurancePayment:0,patientPayment:e.unitPrice*e.quantity,insuranceId:"",insuranceName:"",salesnotes:e.note||""}:{stockId:e.stock.id,quantity:e.quantity,unitPrice:e.unitPrice,insuranceCoverage:e.insuranceCoverage,insurancePayment:e.insurancePayment,patientPayment:e.patientPayment,insuranceId:e.insuranceId,insuranceName:e.insuranceName,salesnotes:e.note||""}),totalPrice:d,totalInsurancePayment:f,totalPatientPayment:b,paymentMode:e.paymentMode};await J.mutateAsync(a),_.o.success("Sale created successfully"),t(!1),ee.reset(),o([]),g(0),N(0),y(0),R.invalidateQueries({queryKey:["sales"]})}catch(e){_.o.error(e instanceof Error?e.message:"Failed to process sale")}},X=async e=>{try{let t=new eY.Ay({orientation:"portrait",unit:"mm",format:[58,200]}),s=5,a=function(e,s,a,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;t.setFontSize(r);let i=t.splitTextToSize(e,n);return i.forEach((e,n)=>{t.text(e,s,a+.4*r*n)}),a+i.length*(.4*r)},n=function(e,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8;return t.setFontSize(a),t.text(e,29,s,{align:"center"}),s+.4*a},r=e=>(t.setLineWidth(.1),t.line(2,e,56,e),e+2);t.setFontSize(12),t.setFont("helvetica","bold"),s=n("INVOICE",s,12)+2,t.setFont("helvetica","normal"),s=r(s)+2,t.setFontSize(7),s=a("ID: ".concat(e.id),2,s,54,7)+1,s=a("Date: ".concat(new Date(e.transactionDate).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})),2,s,54,7)+2,s=r(s)+2,t.setFontSize(8),s=a("Patient: ".concat(e.patientName),2,s,54,8)+1,s=a("Contact: ".concat(e.patientContact),2,s,54,8)+1,e.prescriberName&&(s=a("Prescriber: ".concat(e.prescriberName),2,s,54,8)+1),s=a("Payment: ".concat(e.paymentMode.replace("_"," ")),2,s,54,8)+2,s=r(s)+2,t.setFontSize(8),t.setFont("helvetica","bold"),s=a("ITEMS",2,s,54,8)+1,t.setFont("helvetica","normal"),s=r(s)+2,t.setFontSize(7),e.items.forEach((n,r)=>{s=a("".concat(r+1,". ").concat(n.productName),2,s,54,7)+1,s=a("Qty: ".concat(n.quantitySold," x ").concat(n.unitPrice.toFixed(0)," Rwf"),2,s,54,7)+1,n.insuranceName?(s=a("Insurance: ".concat(n.insuranceName," (").concat(n.insuranceCoverage,"%)"),2,s,54,7)+1,s=a("Ins.Pay: ".concat(n.insurancePayment.toFixed(0)," Rwf"),2,s,27,7),t.text("Pat.Pay: ".concat(n.patientPayment.toFixed(0)," Rwf"),29,s,{align:"right"}),s+=3):s=a("Total: ".concat(n.totalAmount.toFixed(0)," Rwf"),2,s,54,7)+2,n.salesnotes&&(s=a("Note: ".concat(n.salesnotes),2,s,54,6)+2),r<e.items.length-1&&(t.setLineWidth(.05),t.line(7,s,51,s),s+=2)}),s+=2,s=r(s)+2,t.setFontSize(8),t.setFont("helvetica","bold"),s=a("TOTALS",2,s,54,8)+1,t.setFont("helvetica","normal"),s=r(s)+2,t.setFontSize(8),s=a("Subtotal: ".concat(e.totalPrice.toFixed(0)," Rwf"),2,s,54,8)+1,e.totalInsurancePayment>0&&(s=a("Insurance: ".concat(e.totalInsurancePayment.toFixed(0)," Rwf"),2,s,54,8)+1),t.setFont("helvetica","bold"),s=a("PATIENT PAYS: ".concat(e.totalPatientPayment.toFixed(0)," Rwf"),2,s,54,9),t.setFont("helvetica","normal"),s+=3,s=r(s)+2,t.setFontSize(6),s=n("Thank you for your business!",s,6)+2,s=n("Keep this receipt for your records",s,6);let i=Math.max(s+10,200);t.internal.pageSize.height=i,t.save("receipt-".concat(e.id,".pdf")),_.o.success("Receipt downloaded successfully!")}catch(e){_.o.error("Failed to download receipt"),console.error("Receipt download error:",e)}},ee=(0,F.mN)({resolver:(0,M.u)(eA),defaultValues:{patientName:"",patientContact:"",insuranceId:"",insuranceCoverage:0,customInsuranceName:"",insuranceCardNumber:"",principalMemberName:"",prescriberName:"",prescriberLicenseNumber:"",prescriberOrganization:"",prescriberContact:"",prescriberType:"",stockId:"",quantity:1,paymentMode:"",notes:""}}),et=ee.watch("insuranceId"),es=et&&"private"!==et&&"other"!==et&&Array.isArray(T)?T.find(e=>e.id===et):void 0,ea=(null==es?void 0:es.name)||("private"===et?"Private Insurance":"other"===et?"Custom Insurance":void 0);(0,n.useEffect)(()=>{let e=l.reduce((e,t)=>e+t.unitPrice*t.quantity,0),t=l.reduce((e,t)=>e+t.insurancePayment,0),s=l.reduce((e,t)=>e+t.patientPayment,0);g(e),N(t),y(s)},[l]),(0,n.useEffect)(()=>{if(0===l.length)return;let e=ee.watch("insuranceId");console.log("=== Cart Insurance Update ==="),console.log("Insurance changed to:",ea),console.log("Updating",l.length,"cart items");let t=l.map(t=>{let s=0,a="",n="",r=!1,i="";if("private"===e)s=0,a="Private Insurance",n="private";else if("other"===e)s="number"==typeof ee.watch("insuranceCoverage")?ee.watch("insuranceCoverage"):0,a=ee.watch("customInsuranceName")||"Custom Insurance",n="custom";else{let c=Array.isArray(T)?T.find(t=>t.id===e):void 0;if(c){a=c.name,n=c.id;let e=eF(t.stock,c.id);if(e)s=eM(e,0);else{s="number"==typeof ee.watch("insuranceCoverage")?ee.watch("insuranceCoverage"):0;let e=eR(t.stock);if(e&&e.length>0){r=!0;let t=e.map(e=>e.insuranceName).join(", ");i="This product is not covered by ".concat(c.name,". Supported insurances: ").concat(t)}}}}let c="number"==typeof t.unitPrice?t.unitPrice:0,l="number"==typeof t.insuranceCoverage?t.insuranceCoverage:0,o=t.quantity*c;return{...t,insuranceCoverage:s,insurancePayment:l/100*o,patientPayment:(100-l)/100*o,insuranceId:n,insuranceName:a,hasInsuranceMismatch:r,insuranceMismatchMessage:i}});console.log("Cart updated with new insurance coverage"),console.log("================================"),o(t)},[ee.watch("insuranceId"),ee.watch("insuranceCoverage"),ee.watch("customInsuranceName"),ea,T]);let en=e=>{o(l.filter((t,s)=>s!==e))},er=(e,t)=>{if(t<1)return;let s=l[e],a="number"==typeof s.unitPrice?s.unitPrice:0,n="number"==typeof s.insuranceCoverage?s.insuranceCoverage:0,r=t*a,i=[...l];i[e]={...s,quantity:t,insurancePayment:n/100*r,patientPayment:(100-n)/100*r},o(i)};return(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(x.ZB,{children:"Sales Management"}),(0,a.jsx)(x.BT,{children:"View and manage your sales with advanced filtering and sorting"})]}),(0,a.jsxs)(k.lG,{open:e,onOpenChange:t,children:[(0,a.jsx)(k.zM,{asChild:!0,children:(0,a.jsxs)(p.$,{onClick:()=>{t(!0),c(null),r(""),o([]),g(0),N(0),y(0),I(!0)},children:[(0,a.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Add Sale"]})}),(0,a.jsxs)(k.Cf,{className:"sm:max-w-[800px] max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)(k.c7,{children:[(0,a.jsx)(k.L3,{children:"Create New Sale"}),(0,a.jsx)(k.rr,{children:"Create a new sale by entering patient details and adding products"})]}),(0,a.jsx)(Z.Bc,{children:(0,a.jsx)(q,{...ee,children:(0,a.jsxs)("form",{onSubmit:ee.handleSubmit(Y),className:"space-y-6",children:[(0,a.jsx)(eV,{form:ee}),(0,a.jsx)(eB,{form:ee}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Add Products"}),C&&(0,a.jsx)(e_,{selectedStock:i,searchTerm:s,onSearchChange:e=>{r(e),0===e.trim().length?U.reset():U.mutate(e)},onStockSelect:e=>{c(e),ee.setValue("stockId",e.id)},onStockChange:()=>{c(null),ee.setValue("stockId","")},stockSearchData:U.data,isStockSearchLoading:U.isPending,selectedInsuranceId:ee.watch("insuranceId"),selectedInsuranceName:ea,cartItems:l}),!C&&(0,a.jsx)(p.$,{type:"button",variant:"outline",onClick:()=>{I(!0),c(null),r("")},children:"Add Another Product"}),i&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground p-2 bg-gray-50 rounded",children:['Debug: Selected Insurance ID = "',ee.watch("insuranceId"),'"']}),i&&(0,a.jsxs)("div",{className:"flex-1 flex flex-col gap-2 mt-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Product Note (optional)"}),(0,a.jsx)("textarea",{className:"flex min-h-[40px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Add a note for this product...",value:P,onChange:e=>A(e.target.value)}),(0,a.jsx)("label",{className:"text-sm font-medium mt-2",children:"Manual Price (optional)"}),(0,a.jsx)("input",{type:"number",min:"0",step:"0.01",className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Enter manual price (overrides insurance/stock price)",value:S,onChange:e=>E(e.target.value)})]}),i&&(0,a.jsxs)("div",{className:"flex items-end gap-2 mt-4",children:[(0,a.jsx)(z,{control:ee.control,name:"quantity",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{className:"flex-1",children:[(0,a.jsx)(B,{children:"Quantity"}),(0,a.jsx)(G,{children:(0,a.jsx)(m.p,{type:"number",min:1,...t,onChange:e=>t.onChange(Number(e.target.value))})}),(0,a.jsx)(Q,{})]})}}),(0,a.jsx)(p.$,{type:"button",onClick:()=>{if(!i||!ee.watch("quantity"))return;let e=ee.watch("quantity"),t="number"==typeof i.stockDetails.unitPrice?i.stockDetails.unitPrice:0;S&&!isNaN(Number(S))&&Number(S)>0&&(t=Number(S));let s=null,a=ee.watch("insuranceId");i&&a&&(t=(s=eF(i,a))&&"number"==typeof s.insurancePrice?s.insurancePrice:"number"==typeof i.stockDetails.unitPrice?i.stockDetails.unitPrice:0);let n=ee.watch("insuranceId"),d=ee.watch("customInsuranceName")||"",u="number"==typeof ee.watch("insuranceCoverage")?ee.watch("insuranceCoverage"):0,m=0,x="",h="",p=!1,j="";if("private"===n)m=0,x="Private Insurance",h="private";else if("other"===n)m="number"==typeof u?u:0,x=d,h="custom";else{let e=Array.isArray(T)?T.find(e=>e.id===n):void 0;if(e){x=e.name,h=e.id;let t=i?eF(i,e.id):null;if(t)m=eM(t,u);else{m="number"==typeof u?u:0;let t=i?eR(i):[];if(t&&t.length>0){p=!0;let s=t.map(e=>e.insuranceName).join(", ");j="This product is not covered by ".concat(e.name,". Supported insurances: ").concat(s)}}}}let g=("number"==typeof e?e:0)*("number"==typeof t?t:0),f=m/100*g,N=(100-m)/100*g,v={stock:i,quantity:e,unitPrice:t,insuranceCoverage:m,insurancePayment:f,patientPayment:N,insuranceId:h,insuranceName:x,hasInsuranceMismatch:p,insuranceMismatchMessage:j,note:P};o([...l,v]),c(null),r(""),ee.setValue("quantity",1),I(!1),A(""),E("")},disabled:!i,children:"Add to Cart"})]}),l.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium",children:"Cart Items"}),l.map((e,t)=>{var s,n;let r=e.stock?eR(e.stock):[],i=e.stock&&e.insuranceId?eF(e.stock,e.insuranceId):null,c=!!i,d=!r||0===r.length,u=!c||e.hasInsuranceMismatch||"custom"===e.insuranceId||"other"===e.insuranceId||e.insuranceId&&"private"!==e.insuranceId&&"custom"!==e.insuranceId&&"other"!==e.insuranceId&&(r&&r.length>0&&!r.some(t=>t.insuranceId===e.insuranceId)||d);return(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"font-medium",children:(null==(s=e.stock.productData.medicineData)?void 0:s.name)||(null==(n=e.stock.productData.catalogProductData)?void 0:n.name)}),"private"===e.insuranceId&&(0,a.jsx)(h.E,{variant:"outline",className:"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300 border-blue-300 dark:border-blue-600 flex items-center gap-1",children:"Private Insurance"}),u?(0,a.jsx)(Z.Bc,{children:(0,a.jsxs)(Z.m_,{children:[(0,a.jsx)(Z.k$,{asChild:!0,children:(0,a.jsx)("span",{children:(0,a.jsxs)(h.E,{variant:"outline",className:"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-300 border-yellow-300 dark:border-yellow-600 flex items-center gap-1",children:[(0,a.jsx)(eI.A,{className:"h-3 w-3 mr-1"}),"custom"===e.insuranceId||"other"===e.insuranceId?"Custom: Check Coverage":"Insurance Not Supported"]})})}),(0,a.jsx)(Z.ZI,{children:(0,a.jsx)("p",{className:"max-w-xs",children:"custom"===e.insuranceId||"other"===e.insuranceId?"Custom insurance selected. Please ensure this insurance covers the selected product.":e.insuranceMismatchMessage||(d?"This product is not covered by any insurance.":"This product is not covered by the selected insurance.")})})]})}):null]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)(p.$,{type:"button",variant:"outline",size:"icon",className:"h-6 w-6",onClick:()=>er(t,e.quantity-1),children:(0,a.jsx)(ek.A,{className:"h-3 w-3"})}),(0,a.jsx)("span",{className:"w-8 text-center",children:e.quantity}),(0,a.jsx)(p.$,{type:"button",variant:"outline",size:"icon",className:"h-6 w-6",onClick:()=>er(t,e.quantity+1),children:(0,a.jsx)(v.A,{className:"h-3 w-3"})}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground ml-2",children:c&&i&&"number"==typeof i.insurancePrice?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("span",{className:"line-through text-xs text-gray-400 mr-1",children:[e.stock.stockDetails.unitPrice," Rwf"]}),(0,a.jsxs)("span",{className:"text-green-700 dark:text-green-400 font-semibold",children:[i.insurancePrice," Rwf (Coverage Price)"]})]}):(0,a.jsxs)(a.Fragment,{children:[e.stock.stockDetails.unitPrice," Rwf each"]})})]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Total: ",e.quantity*e.unitPrice," Rwf",c&&i&&"number"==typeof i.insurancePrice?(0,a.jsx)("span",{className:"ml-2 text-green-700 dark:text-green-400 font-semibold",children:"(Coverage Price Applied)"}):null,e.insuranceCoverage>0&&" (".concat(e.insuranceCoverage,"% covered by ").concat(e.insuranceName,")")]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("label",{className:"text-xs font-medium",children:"Product Note"}),(0,a.jsx)("textarea",{className:"flex min-h-[32px] w-full rounded-md border border-input bg-background px-2 py-1 text-xs ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Add a note for this product...",value:e.note||"",onChange:s=>{let a=[...l];a[t]={...e,note:s.target.value},o(a)}})]})]}),(0,a.jsx)(p.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>en(t),children:(0,a.jsx)(eP.A,{className:"h-4 w-4"})})]},t)})]}),(0,a.jsxs)("div",{className:"space-y-2 pt-4 border-t",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Total Price:"}),(0,a.jsxs)("span",{children:[d.toFixed(2)," Rwf"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Insurance Payment:"}),(0,a.jsxs)("span",{children:[f.toFixed(2)," Rwf"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Patient Payment:"}),(0,a.jsxs)("span",{children:[b.toFixed(2)," Rwf"]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Payment & Notes"}),(0,a.jsx)(z,{control:ee.control,name:"paymentMode",render:e=>{let{field:t}=e;return(0,a.jsxs)($,{children:[(0,a.jsx)(B,{children:"Patient Payment Mode"}),(0,a.jsxs)(eL.l6,{value:t.value,onValueChange:t.onChange,children:[(0,a.jsx)(G,{children:(0,a.jsx)(eL.bq,{children:(0,a.jsx)(eL.yv,{placeholder:"Select payment mode"})})}),(0,a.jsxs)(eL.gC,{children:[(0,a.jsx)(eL.eb,{value:"cash",children:"Cash"}),(0,a.jsx)(eL.eb,{value:"mobile_money",children:"Mobile Money"}),(0,a.jsx)(eL.eb,{value:"card",children:"Card"})]})]}),(0,a.jsx)(Q,{})]})}})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(p.$,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,a.jsx)(p.$,{type:"submit",disabled:0===l.length||J.isPending,children:J.isPending?"Creating...":"Create Sale"})]})]})})})]})]})]})}),(0,a.jsx)(x.Wu,{children:V?(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsxs)("p",{className:"text-red-500",children:["Error loading sales: ",V.message]})}):(null==O?void 0:O.empty)?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(j.A,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,a.jsx)("h3",{className:"mt-4 text-lg font-semibold",children:"No sales found"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Get started by creating your first sale."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eK,{sales:(null==O?void 0:O.content)||[],onDownloadInvoice:X,isLoading:L}),O&&O.totalPages>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between pt-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",O.numberOfElements," of ",O.totalElements," sales"]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(p.$,{variant:"outline",size:"sm",onClick:()=>D(Math.max(0,w-1)),disabled:O.first,children:"Previous"}),(0,a.jsx)(p.$,{variant:"outline",size:"sm",onClick:()=>D(w+1),disabled:O.last,children:"Next"})]})]})]})})]})}let eW=(0,s(81045).r)(function(){let[e,t]=(0,n.useState)("inventory");return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Inventory Management"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage your inventory and sales"})]}),(0,a.jsxs)(c,{value:e,onValueChange:e=>t(e),children:[(0,a.jsxs)(l,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(o,{value:"inventory",children:"Inventory"}),(0,a.jsx)(o,{value:"sales",children:"Sales"})]}),(0,a.jsx)(d,{value:"inventory",children:(0,a.jsx)(ev,{})}),(0,a.jsx)(d,{value:"sales",children:(0,a.jsx)(eH,{})})]})]})},["USER"])},42098:(e,t,s)=>{"use strict";s.d(t,{A:()=>d,AuthProvider:()=>o});var a=s(66384),n=s(16636),r=s(28330),i=s(24582);let c=(0,n.createContext)(void 0);function l(e){localStorage.setItem("authSession",JSON.stringify(e)),console.log("[Auth] Session stored:",e)}let o=e=>{let{children:t}=e,s=(0,i.useRouter)(),[o,d]=(0,n.useState)(null),[u,m]=(0,n.useState)(null),[x,h]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=function(){let e=localStorage.getItem("authSession");if(!e)return{user:null,tokens:null};try{return JSON.parse(e)}catch(e){return{user:null,tokens:null}}}();d(e.user),m(e.tokens),h(!1),console.log("[Auth] Session loaded on mount:",e)},[]);let p=async e=>{let{emailOrPhone:t,password:s}=e;console.log("[Auth] Attempting login with",t);let a=await fetch("".concat(r.Sn.inventory.base,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emailOrPhone:t,password:s})});if(!a.ok){let e=await a.json().catch(()=>({}));if(console.log("[Auth] Login failed:",e),403===a.status&&"CLIENT_NOT_ACTIVATED"===e.error)throw new r.sv;throw Error(e.message||"Login failed")}let n=await a.json();d(n.user),m({accessToken:n.accessToken,refreshToken:n.refreshToken,tokenType:n.tokenType,expiresIn:n.expiresIn}),l({user:n.user,tokens:{accessToken:n.accessToken,refreshToken:n.refreshToken,tokenType:n.tokenType,expiresIn:n.expiresIn}}),console.log("[Auth] Login successful, session set:",{user:n.user,tokens:n})},j=async e=>{console.log("[Auth] Attempting registration with",e.email,e.phoneNumber);let t=await fetch("".concat(r.Sn.inventory.base,"/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw console.log("[Auth] Registration failed:",e),Error(e.message||"Registration failed")}let s=await t.json();d(s.user),m({accessToken:s.accessToken,refreshToken:s.refreshToken,tokenType:s.tokenType,expiresIn:s.expiresIn}),l({user:s.user,tokens:{accessToken:s.accessToken,refreshToken:s.refreshToken,tokenType:s.tokenType,expiresIn:s.expiresIn}}),console.log("[Auth] Registration successful, session set:",{user:s.user,tokens:s})};return(0,a.jsx)(c.Provider,{value:{user:o,tokens:u,isAuthenticated:!!o,login:p,register:j,logout:()=>{d(null),m(null),localStorage.removeItem("authSession"),console.log("[Auth] Session cleared from storage"),s.push("/auth/login"),console.log("[Auth] Logged out, session cleared")},loading:x},children:t})};function d(){let e=(0,n.useContext)(c);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},50239:(e,t,s)=>{"use strict";s.d(t,{Z:()=>u});var a=s(35639),n=s(98377),r=s(64533),i=s(28330);async function c(){try{let e=await (0,i.v$)(i.Sn.inventory.insurances);if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.message||"Failed to fetch insurances")}return e.json()}catch(e){throw e instanceof i.Ny&&window.location.replace("/auth/login"),e}}async function l(e){try{let t=await (0,i.v$)(i.Sn.inventory.insurances,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||"Failed to create insurance")}return t.json()}catch(e){throw e instanceof i.Ny&&window.location.replace("/auth/login"),e}}async function o(e){try{let t=await (0,i.v$)(i.Sn.inventory.insurance(e.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||"Failed to update insurance")}return t.json()}catch(e){throw e instanceof i.Ny&&window.location.replace("/auth/login"),e}}async function d(e){try{let t=await (0,i.v$)(i.Sn.inventory.insurance(e),{method:"DELETE"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||"Failed to delete insurance")}}catch(e){throw e instanceof i.Ny&&window.location.replace("/auth/login"),e}}function u(){let e=(0,a.jE)(),{data:t=[],isLoading:s,error:i}=(0,n.I)({queryKey:["insurances"],queryFn:c}),{mutateAsync:u,isPending:m,error:x}=(0,r.n)({mutationFn:l,onSuccess:()=>{e.invalidateQueries({queryKey:["insurances"]})}}),{mutateAsync:h,isPending:p,error:j}=(0,r.n)({mutationFn:o,onSuccess:()=>{e.invalidateQueries({queryKey:["insurances"]})}}),{mutateAsync:g,isPending:f,error:N}=(0,r.n)({mutationFn:d,onSuccess:()=>{e.invalidateQueries({queryKey:["insurances"]})}});return{insurances:t,isLoading:s,error:i,createInsurance:u,isCreating:m,createError:x,updateInsurance:h,isUpdating:p,updateError:j,deleteInsurance:g,isDeleting:f,deleteError:N}}},51797:(e,t,s)=>{"use strict";s.d(t,{Bc:()=>i,ZI:()=>o,k$:()=>l,m_:()=>c});var a=s(66384);s(16636);var n=s(68534),r=s(35515);function i(e){let{delayDuration:t=0,...s}=e;return(0,a.jsx)(n.Kq,{"data-slot":"tooltip-provider",delayDuration:t,...s})}function c(e){let{...t}=e;return(0,a.jsx)(i,{children:(0,a.jsx)(n.bL,{"data-slot":"tooltip",...t})})}function l(e){let{...t}=e;return(0,a.jsx)(n.l9,{"data-slot":"tooltip-trigger",...t})}function o(e){let{className:t,sideOffset:s=0,children:i,...c}=e;return(0,a.jsx)(n.ZL,{children:(0,a.jsxs)(n.UC,{"data-slot":"tooltip-content",sideOffset:s,className:(0,r.cn)("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...c,children:[i,(0,a.jsx)(n.i3,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}},62855:(e,t,s)=>{"use strict";s.d(t,{S:()=>c});var a=s(66384);s(16636);var n=s(86862),r=s(94402),i=s(35515);function c(e){let{className:t,...s}=e;return(0,a.jsx)(n.bL,{"data-slot":"checkbox",className:(0,i.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:(0,a.jsx)(n.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,a.jsx)(r.A,{className:"size-3.5"})})})}},79994:(e,t,s)=>{Promise.resolve().then(s.bind(s,25815))},81045:(e,t,s)=>{"use strict";s.d(t,{r:()=>c});var a=s(66384),n=s(16636),r=s(42098),i=s(24582);function c(e,t){let s=s=>{let{isAuthenticated:c,loading:l,user:o}=(0,r.A)(),d=(0,i.useRouter)();return((0,n.useEffect)(()=>{console.log("[withAuth] Auth state:",{loading:l,isAuthenticated:c}),l||c||(console.log("[withAuth] Redirecting to /auth/login"),d.replace("/auth/login"))},[c,l,d]),(0,n.useEffect)(()=>{!l&&c&&t&&o&&(o.roles.some(e=>t.includes(e))||(console.log("[withAuth] User lacks required role, redirecting to /auth/no-access"),d.replace("/")))},[l,c,t,o,d]),l)?(console.log("[withAuth] Waiting for auth session to load..."),null):c?t&&o&&!o.roles.some(e=>t.includes(e))?null:(0,a.jsx)(e,{...s}):(console.log("[withAuth] Not authenticated, rendering null"),null)};return s.displayName="withAuth(".concat(e.displayName||e.name||"Component",")"),s}},94204:(e,t,s)=>{"use strict";s.d(t,{i:()=>i});var a=s(98377),n=s(28330);async function r(e){try{if(!e.trim())return{searchTerm:e,totalResults:0,results:[]};let t=await (0,n.v$)("".concat(n.Sn.inventory.search.unified,"?q=").concat(encodeURIComponent(e)));if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||"Failed to fetch unified search results")}return t.json()}catch(e){throw e instanceof n.Ny&&window.location.replace("/auth/login"),e}}function i(e){return(0,a.I)({queryKey:["unifiedSearch",e],queryFn:()=>r(e),enabled:e.trim().length>0})}},98921:(e,t,s)=>{"use strict";s.d(t,{w:()=>i});var a=s(66384);s(16636);var n=s(75017),r=s(35515);function i(e){let{className:t,orientation:s="horizontal",decorative:i=!0,...c}=e;return(0,a.jsx)(n.b,{"data-slot":"separator-root",decorative:i,orientation:s,className:(0,r.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...c})}}},e=>{var t=t=>e(e.s=t);e.O(0,[5618,9570,9414,2261,5716,8377,7026,9297,9037,6338,8534,2355,6565,9309,951,7358],()=>t(79994)),_N_E=e.O()}]);